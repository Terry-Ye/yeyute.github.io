<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>AT的博客</title>
  <icon>https://www.gravatar.com/avatar/043a5f0fe33061d2d30390f18077d1bf</icon>
  <subtitle>放下杂念,幸福天天</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="//yeyute.github.io/"/>
  <updated>2017-10-23T15:12:03.000Z</updated>
  <id>//yeyute.github.io/</id>
  
  <author>
    <name>AT</name>
    <email>terry.dawu@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2017的秋天-开花</title>
    <link href="//yeyute.github.io/2017/10/23/2017%E7%9A%84%E7%A7%8B%E5%A4%A9-%E5%BC%80%E8%8A%B1/"/>
    <id>//yeyute.github.io/2017/10/23/2017的秋天-开花/</id>
    <published>2017-10-23T14:50:11.000Z</published>
    <updated>2017-10-23T15:12:03.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="开花"><a href="#开花" class="headerlink" title="开花"></a>开花</h3><p>起初播种含羞草时，心里还有种感觉，感觉太过于平凡，不太用心的去浇水，后来初心其实就是为了静心的生活，培养自己有节奏的生活，不对事物麻木，一切都有生机。</p><p>这是今天开的花球<br><img src="/assets/hxc.jpeg" alt=""></p><a id="more"></a><p><img src="/assets/hxc3.jpeg" alt=""></p><p>另外还有薰衣草未开花，淘宝买的种子，一直怀疑种子货不对版，不过还好，一步步的心里没那么看重不否是薰衣草了，更看重自己能不能养得好，之前养过鱼，水草，都没超过半年，没把它们养好，这次我只是想一直的养下去。</p><p><img src="/assets/xunyicao.jpeg" alt=""></p>]]></content>
    
    <summary type="html">
    
      花花草草
    
    </summary>
    
      <category term="Life" scheme="//yeyute.github.io/categories/Life/"/>
    
    
      <category term="生活" scheme="//yeyute.github.io/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>lumen 错误总结(初步整理)</title>
    <link href="//yeyute.github.io/2017/10/18/lumen-%E9%94%99%E8%AF%AF%E6%80%BB%E7%BB%93/"/>
    <id>//yeyute.github.io/2017/10/18/lumen-错误总结/</id>
    <published>2017-10-18T08:04:49.000Z</published>
    <updated>2017-10-23T14:48:53.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="错误汇总"><a href="#错误汇总" class="headerlink" title="错误汇总"></a>错误汇总</h3><figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 问题</span></div><div class="line">[Symfony\Component\Debug\Exception\FatalThrowableError]</div><div class="line">  Type error: Argument 1 passed to Illuminate\Cache\RedisStore::__construct() must be an<span class="built_in"> instance </span>of Illuminate\Contracts\Redis\Factory,<span class="built_in"> instance </span>of Illuminate\Support\Facades\Redis given, called in /www/sailLivePHP/vendor/illuminate/cache/CacheManager.php on line 200</div><div class="line"></div><div class="line"><span class="comment"># 解决，在 bootstrap/app.php 添加</span></div><div class="line"></div><div class="line">$app-&gt;register(\Illuminate\Redis\RedisServiceProvider::class);</div></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 问题</span></div><div class="line">[ReflectionException]</div><div class="line">  Class redis <span class="keyword">does</span> <span class="keyword">not</span> exist</div><div class="line"></div><div class="line"><span class="comment"># 解决， 在composer.json 中添加，个人是少添加第二条</span></div><div class="line"><span class="string">"predis/predis"</span>: <span class="string">"^1.1"</span>,</div><div class="line"><span class="string">"illuminate/redis"</span>: <span class="string">"^5.3"</span>,</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      lumen框架,php,laravel
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="php" scheme="//yeyute.github.io/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>使用php swoole扩展实现IM系统</title>
    <link href="//yeyute.github.io/2017/06/18/%E4%BD%BF%E7%94%A8php-swoole%E6%89%A9%E5%B1%95%E5%AE%9E%E7%8E%B0IM%E7%B3%BB%E7%BB%9F/"/>
    <id>//yeyute.github.io/2017/06/18/使用php-swoole扩展实现IM系统/</id>
    <published>2017-06-18T08:17:49.000Z</published>
    <updated>2017-10-10T12:08:48.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h3><ol><li>php7 + predis 扩展 + swoole2.0.7 扩展 + swoole framework框架</li><li>mysql5.7 + redis 3.2.1  </li><li>supervisor（进程监控，自动重启进程等功能）</li><li><p><a href="https://github.com/yeyute/php-swoole-IM.git" target="_blank" rel="external">https://github.com/yeyute/php-swoole-IM.git</a> 后端代码，README.md 有前端接入方法（ps:如果对你开发有帮助，请来个start）</p><a id="more"></a></li></ol><h3 id="使用swoole-framework开发-IM-系统"><a href="#使用swoole-framework开发-IM-系统" class="headerlink" title="使用swoole framework开发 IM 系统"></a>使用swoole framework开发 IM 系统</h3><p>优点：</p><ol><li>简单易用且开发效率高</li><li>有大平台选用案例，例：虎牙直播，yy语音</li><li>纯C编写性能强等</li></ol><h4 id="supervisor-进程监控-说明"><a href="#supervisor-进程监控-说明" class="headerlink" title="supervisor 进程监控 说明"></a>supervisor 进程监控 说明</h4><p>查看<a href="http://www.cnblogs.com/shijingjing07/p/6024066.html" target="_blank" rel="external">http://www.cnblogs.com/shijingjing07/p/6024066.html</a> 文章，清晰</p><h3 id="系统架构逻辑"><a href="#系统架构逻辑" class="headerlink" title="系统架构逻辑"></a>系统架构逻辑</h3><p>以下是 微信端 用户通讯信息的逻辑架构示例：</p><p><img src="https://yeyute.github.io/assets/im.jpg" alt=""></p><p>注： </p><ol><li>有区分不同的直播频道，每个频道的用户都写入在不同的redis集合中，每次发信息广播时，都会在web层广播该频道的所有用户。 </li><li>图中*号代表每次广播给所有用户 </li><li>ios手机关屏会断会断开链接</li></ol><h3 id="系统性能-根据官方给的压测信息"><a href="#系统性能-根据官方给的压测信息" class="headerlink" title="系统性能(根据官方给的压测信息)"></a>系统性能(根据官方给的压测信息)</h3><p>根据开发环境的压测结果（cpu:2, 内存:4G），只进行消息通讯（未连接redis,mysql等），结果准确性待考验。</p><table><thead><tr><th style="text-align:left">并发数</th><th style="text-align:left">总请求数</th><th style="text-align:left">qps</th><th style="text-align:left">平均响应/ms</th><th style="text-align:left">请求失败数量</th><th style="text-align:left">请求成功数量</th></tr></thead><tbody><tr><td style="text-align:left">1000</td><td style="text-align:left">10000</td><td style="text-align:left">2949</td><td style="text-align:left">0.339</td><td style="text-align:left">0</td><td style="text-align:left">10000</td></tr><tr><td style="text-align:left">2000</td><td style="text-align:left">10000</td><td style="text-align:left">1574</td><td style="text-align:left">0.635</td><td style="text-align:left">0</td><td style="text-align:left">10000</td></tr><tr><td style="text-align:left">3000</td><td style="text-align:left">10000</td><td style="text-align:left">1089</td><td style="text-align:left">0.917</td><td style="text-align:left">0</td><td style="text-align:left">10000</td></tr><tr><td style="text-align:left">4000</td><td style="text-align:left">10000</td><td style="text-align:left">807</td><td style="text-align:left">1.238</td><td style="text-align:left">0</td><td style="text-align:left">10000</td></tr></tbody></table><p>测试机压开发环境，结果如下：</p><table><thead><tr><th style="text-align:left">并发数</th><th style="text-align:left">总请求数</th><th style="text-align:left">qps</th><th style="text-align:left">平均响应/ms</th><th style="text-align:left">请求失败数量</th><th style="text-align:left">请求成功数量</th></tr></thead><tbody><tr><td style="text-align:left">800</td><td style="text-align:left">5000</td><td style="text-align:left">1461</td><td style="text-align:left">0.684</td><td style="text-align:left">0</td><td style="text-align:left">5000</td></tr><tr><td style="text-align:left">1000</td><td style="text-align:left">5000</td><td style="text-align:left">1209</td><td style="text-align:left">0.826</td><td style="text-align:left">0</td><td style="text-align:left">5000</td></tr><tr><td style="text-align:left">1200</td><td style="text-align:left">5000</td><td style="text-align:left">1032</td><td style="text-align:left">0.968</td><td style="text-align:left">0</td><td style="text-align:left">5000</td></tr><tr><td style="text-align:left">2000</td><td style="text-align:left">5000</td><td style="text-align:left">628</td><td style="text-align:left">1.592</td><td style="text-align:left">0</td><td style="text-align:left">5000</td></tr></tbody></table><p>在可控的并发请求情况下，性能尚可。</p><h3 id="系统健壮性"><a href="#系统健壮性" class="headerlink" title="系统健壮性"></a>系统健壮性</h3><h4 id="监控方案"><a href="#监控方案" class="headerlink" title="监控方案"></a>监控方案</h4><p>发生情况：在某些情况下，如系统负载过大swoole无法申请到内存而挂掉、swoole底层发生段错误、Server占用内存过大被内核Kill，或者被某些程序误杀的情况，</p><p>监控原理：supervisor 进程管理工具，检测server的master进程是否存活，如果存在则跳过。如果发现主进程已经挂掉，则执行restart逻辑，先kill掉所有残留的子进程，然后重新启动Server。</p><p>保证服务进程挂后可以重新启动</p><h4 id="聊天频率限制"><a href="#聊天频率限制" class="headerlink" title="聊天频率限制"></a>聊天频率限制</h4><ol><li>限制 1秒内1条信息(条件信息可改)</li></ol><h3 id="数据表结构"><a href="#数据表结构" class="headerlink" title="数据表结构"></a>数据表结构</h3><h4 id="消息表"><a href="#消息表" class="headerlink" title="消息表"></a>消息表</h4><table><thead><tr><th style="text-align:left">字段</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">id</td><td style="text-align:left">主键</td></tr><tr><td style="text-align:left">client_id</td><td style="text-align:left">用户id</td></tr><tr><td style="text-align:left">user_name</td><td style="text-align:left">用户名</td></tr><tr><td style="text-align:left">user_id</td><td style="text-align:left">用户id</td></tr><tr><td style="text-align:left">message</td><td style="text-align:left">消息内容</td></tr><tr><td style="text-align:left">type</td><td style="text-align:left">业务类型</td></tr><tr><td style="text-align:left">activity_id</td><td style="text-align:left">直播活动id</td></tr><tr><td style="text-align:left">create_time</td><td style="text-align:left">创建时间</td></tr><tr><td style="text-align:left">ip</td><td style="text-align:left">用户ip</td></tr></tbody></table><h4 id="直播活动表"><a href="#直播活动表" class="headerlink" title="直播活动表"></a>直播活动表</h4><table><thead><tr><th style="text-align:left">字段</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">id</td><td style="text-align:left">主键</td></tr><tr><td style="text-align:left">title</td><td style="text-align:left">标题</td></tr><tr><td style="text-align:left">details</td><td style="text-align:left">活动详情</td></tr><tr><td style="text-align:left">share_title</td><td style="text-align:left">分享title</td></tr><tr><td style="text-align:left">share_digest</td><td style="text-align:left">分享摘要</td></tr><tr><td style="text-align:left">start_time</td><td style="text-align:left">开始时间</td></tr><tr><td style="text-align:left">end_time</td><td style="text-align:left">结束时间</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      hexo
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="php" scheme="//yeyute.github.io/tags/php/"/>
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>golang 学习笔记一(基础部分)</title>
    <link href="//yeyute.github.io/2017/05/03/go-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%80/"/>
    <id>//yeyute.github.io/2017/05/03/go-学习笔记一/</id>
    <published>2017-05-03T02:08:15.000Z</published>
    <updated>2017-10-10T12:09:56.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Go语言最主要的特性"><a href="#Go语言最主要的特性" class="headerlink" title="Go语言最主要的特性"></a>Go语言最主要的特性</h3><p>自动垃圾回收<br>更丰富的内置类型<br>函数多返回值<br>错误处理<br>匿名函数和闭包<br>类型和接口<br>并发编程<br>反射<br>语言交互性</p><a id="more"></a><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><p>windows 版<br>GOROOT: go的安装路径,官方包路径根据这个设置自动匹配<br>GOPATH: 工作路径(其实不应该用中文翻译解释，直接说GOPATH更合适)</p><p><img src="https://yeyute.github.io/assets/go_path.png" alt="配置环境变量"></p><h3 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h3><ol><li>go语言中所有类型的命名都必须以一个字母或下划线开发，后面可以 跟字母、数字、下划线，且区分大小写</li><li>关键字不能用于自定义名字,以下是关键字25个</li></ol><figure class="highlight d"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># 关键字</div><div class="line"><span class="keyword">break</span>      <span class="keyword">default</span>       func</div><div class="line"><span class="keyword">case</span>       defer         go</div><div class="line">chan       <span class="keyword">else</span>          <span class="keyword">goto</span></div><div class="line"><span class="keyword">const</span>      fallthrough   <span class="keyword">if</span></div><div class="line"><span class="keyword">interface</span></div><div class="line">map</div><div class="line"><span class="keyword">package</span></div><div class="line">range</div><div class="line">select</div><div class="line"><span class="keyword">struct</span></div><div class="line"><span class="keyword">switch</span></div><div class="line">type</div><div class="line"><span class="keyword">continue</span> <span class="keyword">for</span></div><div class="line"><span class="keyword">import</span>   <span class="keyword">return</span>      var</div></pre></td></tr></table></figure><ol><li>预定义名字30多个，可以再定义中使用他们，注意避免过度而引起语义混乱 </li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">内建常量: <span class="literal">true</span> <span class="literal">false</span> <span class="literal">iota</span> <span class="literal">nil</span></div><div class="line">内建类型: <span class="keyword">int</span> <span class="keyword">int8</span> <span class="keyword">int16</span> <span class="keyword">int32</span> <span class="keyword">int64</span></div><div class="line">         <span class="keyword">uint</span> <span class="keyword">uint8</span> <span class="keyword">uint16</span> <span class="keyword">uint32</span> <span class="keyword">uint64</span> <span class="keyword">uintptr</span></div><div class="line">         <span class="keyword">float32</span> <span class="keyword">float64</span> <span class="keyword">complex128</span> <span class="keyword">complex64</span></div><div class="line">         <span class="keyword">bool</span> <span class="keyword">byte</span> <span class="keyword">rune</span> <span class="keyword">string</span> error</div><div class="line">内建函数: <span class="built_in">make</span> <span class="built_in">len</span> <span class="built_in">cap</span> <span class="built_in">new</span> <span class="built_in">append</span> <span class="built_in">copy</span> <span class="built_in">close</span> <span class="built_in">delete</span> <span class="built_in">complex</span> <span class="built_in">real</span> <span class="built_in">imag</span></div><div class="line">          <span class="built_in">panic</span> <span class="built_in">recover</span></div></pre></td></tr></table></figure><ol><li>函数内部定义的名字，那么只在函数内部有效</li><li>函数外部定义，那么当前包的所有文件都有效</li><li>名字开头字母大写决定 （必须在函数外部定义的包级名字），大小写决定包外的可见性，大写为可以被外部访问</li><li>推荐驼峰命名</li></ol><h3 id="声明（4种类型）"><a href="#声明（4种类型）" class="headerlink" title="声明（4种类型）"></a>声明（4种类型）</h3><ul><li>变量</li><li>常量</li><li>类型</li><li>函数</li></ul><h4 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">var</span> 变量名字 类型 = 表达式</div></pre></td></tr></table></figure><p>其中的 类型 或 “= 表达式” 两个部分可以省略其中的一个，类型被省略的话会根据表达式来推导变量的类型， 表达式被省略的话，数值的类型为0，布尔类型对应为false,字符串是空，接口或引用类型（slice、map、chan和函数）亦是对应的是nil</p><p>简短声明语句<br>变量 := 表达式， 同时也可以声明一组变量<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">i</span>,<span class="built_in">j</span> := <span class="number">0</span>,<span class="number">1</span></div></pre></td></tr></table></figure></p><p>而交换变量的语法，不要和上面的声明混一起了<br><figure class="highlight matlab"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">i</span>, <span class="built_in">j</span> = <span class="built_in">j</span>, <span class="built_in">i</span></div></pre></td></tr></table></figure></p><p>和普通var形式的变量声明语句一样,可以用函数的返回值来声明和初始化，像下面os.Open函数调用将返回两个值，如果简短的变量声明过，就是赋值<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">f, <span class="keyword">err</span> := os.<span class="keyword">Open</span>(name)</div><div class="line"><span class="keyword">if</span> <span class="keyword">err</span> != nil &#123;</div><div class="line"><span class="keyword">return</span> <span class="keyword">err</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// ...use f...</span></div><div class="line">f.<span class="keyword">Close</span>()</div></pre></td></tr></table></figure></p><p>注意的是，简短的变量声明必须有一个新的变量，否则不能通过，例：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">f, <span class="keyword">err</span> := os.<span class="keyword">Open</span>(<span class="keyword">infile</span>)</div><div class="line"><span class="comment">// ...</span></div><div class="line">f, <span class="keyword">err</span> := os.Create(<span class="keyword">outfile</span>) <span class="comment">// compile error: no new variables</span></div></pre></td></tr></table></figure></p><p>解决的方法是第二个简短变量声明语句改用普通的多重赋值语言</p><h4 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h4><p>一个变量对应一个保存了变量对应类型值的内存空间<br>一般 <em>p  表达式读取指针指向的变量的值，这里<br>为int类型的值，同时因为 </em>p  对应一个变量，所以该表达式也可以出现在赋值语句的左边，表<br>示更新指针所指向的变量的值<br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">x</span> := <span class="number">1</span></div><div class="line">p := &amp;<span class="keyword">x</span> // p, of <span class="keyword">type</span> *int, points <span class="keyword">to</span> <span class="keyword">x</span></div><div class="line">fmt.Println(*p) // <span class="string">"1"</span></div><div class="line">*p = <span class="number">2</span> // equivalent <span class="keyword">to</span> <span class="keyword">x</span> = <span class="number">2</span></div><div class="line">fmt.Println(<span class="keyword">x</span>) // <span class="string">"2"</span></div></pre></td></tr></table></figure></p><p>任何类型的指针的零值都是nil</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var x, y int</div><div class="line">fmt.Println(<span class="variable">&amp;x</span> == <span class="variable">&amp;x</span>, <span class="variable">&amp;x</span> == <span class="variable">&amp;y</span>, <span class="variable">&amp;x</span> == nil) <span class="comment">// "true false false"</span></div></pre></td></tr></table></figure><h4 id="new-函数"><a href="#new-函数" class="headerlink" title="new 函数"></a>new 函数</h4><p>可以用new函数来创建变量，和普通的变量声明一样，没区别<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">p := <span class="keyword">new</span>(<span class="keyword">int</span>) // p, *<span class="keyword">int</span> 类型, 指向署名的<span class="keyword">int</span>变量</div><div class="line">fmt.Println(*p) // <span class="string">"0"</span></div><div class="line">*p=2 // 设 <span class="keyword">int</span>  变  值为 2 </div><div class="line">fmt.Println(*p) // <span class="string">"2"</span></div></pre></td></tr></table></figure></p><p>每次new函数都是返回一个新的变量的地址，因此下面两个变量是不同的<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p := <span class="keyword">new</span>(<span class="keyword">int</span>)</div><div class="line">q := <span class="keyword">new</span>(<span class="keyword">int</span>)</div><div class="line">fmt.Println(p == q) // <span class="string">"false"</span></div></pre></td></tr></table></figure></p><p>当然有特殊情况，两个类型都为空，也就是说类型的大小是0，例如 struct{} 和 [0]int,有可能有相同的地址，（谨慎使用大小为0的类型）</p><p>由于new是一个预定义的函数，它并不是一个关键字，因此我们可以将new名字重新定义为别的类型。例如</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">delta</span><span class="params">(old, <span class="built_in">new</span> <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> <span class="built_in">new</span> - old&#125;</div></pre></td></tr></table></figure><p>由于new 被定义为 int类型的变量名，因此在delta 函数内部无法使用内置的new函数</p><h4 id="变量的生命周期"><a href="#变量的生命周期" class="headerlink" title="变量的生命周期"></a>变量的生命周期</h4><ol><li>在包一级声明的变量来说，它们的生命周期和整个程序的运行周期是一致的</li><li>局部变量的声明周期是动态的：从每次创建一个新变量的声明语句开始，到变量不再被引用，然后变量的存储空间可能被回收，函数的参数变量和返回值变量都是局部变量，它们在函数被调用时创建</li></ol><h4 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h4><p>一个类型声明语句创建了一个新的类型名称，和现有类型具有相同的底层结构。</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> <span class="type">类型名字 </span>底层类型</div></pre></td></tr></table></figure><p>类型声明语句一般出现在包一级，首字母大写则在外部包也可以使用</p><h3 id="第一个go"><a href="#第一个go" class="headerlink" title="第一个go"></a>第一个go</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 每个Go源代码文件的开头都是一个 <span class="keyword">package</span> 声明，表示该Go代码所属的包</div><div class="line"><span class="keyword">package</span> main</div><div class="line"># <span class="keyword">import</span> 语句，用于导入该程序所依赖的包。由于本示例程序用到了 Println() 函数，所以需要导入该函数所属的 fmt 包</div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span><span class="comment">// 我们需要使用fmt包中的Println()函数</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    fmt.Println(<span class="string">"Hello, world. 你好，世界！"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>要生成Go可执行程序，必须建立一个名字为 main 的包，并且在该包中包含一个叫 main() 的函数（该函数是Go可执行程序的执行起点）<br>Go语言的 main() 函数不能带参数，也不能定义返回值。</p><h3 id="函数格式"><a href="#函数格式" class="headerlink" title="函数格式"></a>函数格式</h3><p>所有Go函数（包括在对象编程中会提到的类型成员函数）以关键字 func 开头。Go支持多个返回值<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> 函数名<span class="params">(参数列表)</span><span class="params">(返回值列表)</span></span> &#123;</div><div class="line"><span class="comment">// 函数体</span></div><div class="line">&#125;</div><div class="line"># 对应的一个实例如下</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Compute</span><span class="params">(value1 <span class="keyword">int</span>, value2 <span class="keyword">float64</span>)</span><span class="params">(result <span class="keyword">float64</span>, err error)</span></span> &#123;</div><div class="line"><span class="comment">// 函数体</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h3 id="开发规范"><a href="#开发规范" class="headerlink" title="开发规范"></a>开发规范</h3><p>Go语言很可能是第一个将代码风格强制统一的语言，例如Go语言要求 public 的变量必须以大写字母开头， private 变量则以小写字母开头，这种做法不仅免除了 public 、 private 关键字，更重要的是统一了命名风格<br>Go语言对 { } 应该怎么写进行了强制<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 正确</div><div class="line"><span class="keyword">if</span> expression &#123;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>以下错误的示例将报错 syntax error: unexpected semicolon or newline before {<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> expression</div><div class="line">&#123;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h3 id="string-类型"><a href="#string-类型" class="headerlink" title="string  类型"></a>string  类型</h3><p>+ 运算符是连接字符串 (跟js一样)</p><h3 id="循环格式（Go语言只有for循环这一种循环语句）"><a href="#循环格式（Go语言只有for循环这一种循环语句）" class="headerlink" title="循环格式（Go语言只有for循环这一种循环语句）"></a>循环格式（Go语言只有for循环这一种循环语句）</h3><p>循环索引变量i在for循环的第一部分中定义。符号 :=  是短变量声明（short variable<br>declaration）的一部分, 这是定义一个或多个变量并根据它们的初始值为这些变量赋予适当类<br>型的语句。<br>for循环三个部分不需括号包围。大括号强制要求, 左大括号必须和post语句在同一行。例：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> <span class="keyword">initialization</span>; condition; post &#123;</div><div class="line"><span class="comment">// zero or more statements</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// a traditional "while" loop 一个无限循环</span></div><div class="line"><span class="keyword">for</span> <span class="keyword">condition</span> &#123;</div><div class="line"><span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>如果连 condition  也省略了，像下面这样：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// a traditional infinite loop 一个无限循环</span></div><div class="line"><span class="keyword">for</span> &#123;</div><div class="line"><span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>另外<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    s, sep := <span class="string">""</span>, <span class="string">""</span></div><div class="line">    <span class="comment">// _ 为空标识符 用于任何语法需要变量名但程序逻辑不需要的时候 </span></div><div class="line">    <span class="keyword">for</span> _, arg := <span class="keyword">range</span> os.Args[<span class="number">1</span>:] &#123;</div><div class="line">        s += sep + arg</div><div class="line">        sep = <span class="string">" "</span></div><div class="line">    &#125;</div><div class="line">    fmt.Println(s)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h3 id="变量声明-1"><a href="#变量声明-1" class="headerlink" title="变量声明"></a>变量声明</h3><p>Go语言引入了关键字 var ，而类型信息放在变量名之后，示例如下<br>数值类型是0，字符串类型是空字符串””<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> v1 <span class="keyword">int</span></div><div class="line"><span class="keyword">var</span> v2 <span class="keyword">string</span> <span class="comment">// 依赖于字符串的默认初始化零值机制，被初始化为""。</span></div><div class="line"><span class="keyword">var</span> v3 [<span class="number">10</span>]<span class="keyword">int</span>  <span class="comment">// 数组</span></div><div class="line"><span class="keyword">var</span> v4 []<span class="keyword">int</span> <span class="comment">// 数组切片</span></div><div class="line"><span class="keyword">var</span> v5 <span class="keyword">struct</span> &#123;</div><div class="line">f <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> v6 *<span class="keyword">int</span> <span class="comment">// 指针</span></div><div class="line"><span class="keyword">var</span> v7 <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>  <span class="comment">// map，key为string类型，value为int类型</span></div><div class="line"><span class="keyword">var</span> v8 <span class="function"><span class="keyword">func</span><span class="params">(a <span class="keyword">int</span>)</span> <span class="title">int</span></span></div></pre></td></tr></table></figure></p><p>var 关键字的另一种用法是可以将若干个需要声明的变量放置在一起<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">var</span> (</div><div class="line">    <span class="built_in">v1</span> int</div><div class="line">    <span class="built_in">v2</span> <span class="keyword">string</span></div><div class="line">)</div></pre></td></tr></table></figure></p><p>变量时需要进行初始化的场景,var 关键字可以保留，但不再是必要的元素，如下<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> v1 <span class="keyword">int</span> = <span class="number">10</span> <span class="comment">// 正确的使用方式1</span></div><div class="line"><span class="keyword">var</span> v2 = <span class="number">10</span>  <span class="comment">// 正确的使用方式2，编译器可以自动推导出v2的类型</span></div><div class="line">v3 := <span class="number">10</span>  <span class="comment">// 正确的使用方式3，编译器可以自动推导出v3的类型</span></div></pre></td></tr></table></figure></p><p>出现在 := 左侧的变量不应该是已经被声明过的，否则会导致编译错误,例<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">var</span> <span class="selector-tag">i</span> int</div><div class="line"><span class="selector-tag">i</span> := <span class="number">2</span></div><div class="line"><span class="comment">// 会导致类似如下的编译错误：</span></div><div class="line">no new variables on <span class="attribute">left</span> side of :=a</div></pre></td></tr></table></figure></p><h3 id="变量赋值（多重赋值功能）"><a href="#变量赋值（多重赋值功能）" class="headerlink" title="变量赋值（多重赋值功能）"></a>变量赋值（多重赋值功能）</h3><p>在不支持多重赋值的语言中,交互两个变量的内容需要引入一个中间变量<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">t</span> = i; <span class="attribute">i</span> = j; <span class="attribute">j</span> = t;</div></pre></td></tr></table></figure></p><p>支持多重赋值,交互两个变量的内容 的语句</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">i</span>, <span class="built_in">j</span> = <span class="built_in">j</span>, <span class="built_in">i</span></div></pre></td></tr></table></figure><h3 id="匿名变量（有点意思）"><a href="#匿名变量（有点意思）" class="headerlink" title="匿名变量（有点意思）"></a>匿名变量（有点意思）</h3><p>为解决在调用函数时为了获取一个值 ，却返回多个值而不得不定义一堆没用的变量的时候，go的优雅写法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetName</span><span class="params">()</span> <span class="params">(firstName, lastName, nickName <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"May"</span>, <span class="string">"Chan"</span>, <span class="string">"Chibi Maruko"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>若只想获取nickName，则函数调用语句可以 用如下方式编写</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">_</span>, <span class="keyword">_</span>, nickName :=GetName()</div></pre></td></tr></table></figure><h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3><p>const 关键字定义<br>go 常量定义可以 限定常量类型，但不是必须的<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> (</div><div class="line">    <span class="built_in">size</span> int64 = <span class="number">1024</span> <span class="comment">// 有类型</span></div><div class="line">    eof = <span class="number">-1</span>  <span class="comment">// 无类型</span></div><div class="line">)</div></pre></td></tr></table></figure></p><h3 id="预定义常量"><a href="#预定义常量" class="headerlink" title="预定义常量"></a>预定义常量</h3><p>go 语言预定义了这些常量： true、false和iota<br>iota 比较特殊，可以认为是一个可被编译器修改的常量，在每一个const 关键字出现时重置为0，每出现一次iota,其代表的数字会自动增1.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> (          <span class="comment">// iota 被重置为0</span></div><div class="line">    c0 = <span class="literal">iota</span>    <span class="comment">// co = 0</span></div><div class="line">    c1 = <span class="literal">iota</span>    <span class="comment">// co = 1           </span></div><div class="line">    c2 = <span class="literal">iota</span>   <span class="comment">// co = 2</span></div><div class="line">)</div></pre></td></tr></table></figure><h3 id="类型-1"><a href="#类型-1" class="headerlink" title="类型"></a>类型</h3><h4 id="布尔类型"><a href="#布尔类型" class="headerlink" title="布尔类型"></a>布尔类型</h4><p>布尔类型不能接受其它类型的赋值，不支持自动或强制的类型转换，以下错误的用户，会导致编译错误</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">var</span> <span class="selector-tag">b</span> bool</div><div class="line"><span class="selector-tag">b</span> = <span class="number">1</span> <span class="comment">// 编译错误 </span></div><div class="line">了= bool(<span class="number">1</span>) <span class="comment">// 编译错误</span></div></pre></td></tr></table></figure><p>以下是正确</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">var</span> <span class="selector-tag">b</span> bool</div><div class="line"><span class="selector-tag">b</span> = (<span class="number">1</span> != <span class="number">0</span> ) <span class="comment">//编译正确</span></div><div class="line">fmt.Println(b) 打印结果为true</div></pre></td></tr></table></figure><h4 id="整形"><a href="#整形" class="headerlink" title="整形"></a>整形</h4><p>需要注意的是int和int32 在go 语言里被认为是两种不同的类型，编译器不会帮你自动做类型转换，例下 有编译错误 </p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var <span class="keyword">value</span><span class="number">2</span> int<span class="number">32</span></div><div class="line"><span class="keyword">value</span><span class="number">1</span> := <span class="number">64</span> <span class="comment">// value1 将会被自动推导为int 类型</span></div><div class="line"><span class="keyword">value</span><span class="number">2</span> = <span class="keyword">value</span><span class="number">1</span> <span class="comment">// 编译错误</span></div></pre></td></tr></table></figure><p>错误类似于</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cannot <span class="keyword">use</span> value1 (<span class="class"><span class="keyword">type</span> <span class="title">int</span></span> ) <span class="keyword">as</span> <span class="class"><span class="keyword">type</span> <span class="title">int32</span></span> <span class="keyword">in</span> assignment</div></pre></td></tr></table></figure><p>使用强制类型转换可以解决</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">value</span><span class="number">2</span> = int<span class="number">32</span>(<span class="keyword">value</span><span class="number">1</span>) <span class="comment">// 编译通过</span></div></pre></td></tr></table></figure><p>另外不同类型的整形数不能直接比较 ，例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> i <span class="keyword">int32</span></div><div class="line"><span class="keyword">var</span> j <span class="keyword">int64</span></div><div class="line"><span class="keyword">if</span> i == j &#123; <span class="comment">// 编译出错</span></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> i == <span class="number">1</span> || j == <span class="number">2</span> &#123; <span class="comment">// 编译通过 </span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h3><p>go定义了两个 float32（c语言中的float） 和float64(c 语言中double类型)，<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fvalue1 <span class="keyword">float32</span></div><div class="line">fvalue2 := <span class="number">12.0</span> <span class="comment">// 类型自动被设为float64, 如果不加小数点，fvalue2 会被推导为整形而不是浮点型</span></div><div class="line"></div><div class="line">fvalue1 = fvalue2 <span class="comment">// 不同类型会编译出错</span></div><div class="line">fvalue1 = <span class="keyword">float32</span>(fvalue2)</div></pre></td></tr></table></figure></p><p>另注意浮点数不能像整形那样直接用==来判断两个浮点数是否相等，推荐替代的方案<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">"math"</span></div><div class="line"></div><div class="line"><span class="comment">// p 为用户自定义的比较精度，比如 0.0000001</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsEqual</span><span class="params">(f1, f2, p <span class="keyword">float64</span>)</span> <span class="title">bool</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> math.Fdim(f1, f2) &lt; p</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>声明方法</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[32]byte                    // 长度为32的数组，每个元素为一个字节 </div><div class="line">[2*N] struct &#123; x, y int32 &#125; // 复杂类型数组</div><div class="line">[1000]*float64              // 指针数组</div><div class="line">[<span class="string">3</span>][<span class="symbol">5</span>]int                   // 二维数组</div><div class="line">[<span class="string">2</span>][<span class="symbol">2</span>][<span class="string">2</span>]float64            // 等同于[<span class="string">2</span>](<span class="link">[2]([2]float64</span>))</div></pre></td></tr></table></figure><p>例 [3][5] 表达是3行5表的二维整数数组，总共可以 放15个整型元素<br>注： 在go 数组长度在定义后就不可更改</p><p>另外go有一个关键字 range,用于便捷地遍历容器中的元素，range 具有两个返回 值，一个是数组下标，一个是元素的值<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">for i,v<span class="keyword"> :</span>= range<span class="built_in"> array </span>&#123;</div><div class="line">    fmt.Println(<span class="string">"Array element["</span>, i, <span class="string">"]="</span>, v)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>需注意的是<br>go 数组是一个值类型。所有的值类型变量在赋值和作为参数传递时都将产生一次复制动作。如果将数组作为函数的参数类型，则在函数调用时该 参数将发生数据复制。因此，在函数体中无法修改传入的数组的内容，因为函数内操作的只是所 传入数组的一个副本</p><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"><span class="comment">// PersonInfo是一个包含个人详细信息的类型 type PersonInfo struct &#123;</span></div><div class="line">    ID <span class="keyword">string</span></div><div class="line">    Name <span class="keyword">string</span> Address <span class="keyword">string</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> personDB <span class="keyword">map</span>[<span class="keyword">string</span>] PersonInfo</div><div class="line">    personDB = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>] PersonInfo)</div><div class="line">    <span class="comment">// 往这个map里插入几条数据</span></div><div class="line">    personDB[<span class="string">"12345"</span>] = PersonInfo&#123;<span class="string">"12345"</span>, <span class="string">"Tom"</span>, <span class="string">"Room 203,..."</span>&#125; personDB[<span class="string">"1"</span>] = PersonInfo&#123;<span class="string">"1"</span>, <span class="string">"Jack"</span>, <span class="string">"Room 101,..."</span>&#125;</div><div class="line">    <span class="comment">// 从这个map查找键为"1234"的信息 person, ok := personDB["1234"]</span></div><div class="line">    <span class="comment">// ok是一个返回的bool型，返回true表示找到了对应的数据 if ok &#123;</span></div><div class="line">            fmt.Println(<span class="string">"Found person"</span>, person.Name, <span class="string">"with ID 1234."</span>)</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    fmt.Println(<span class="string">"Did not find person with ID 1234."</span>)</div><div class="line">&#125; &#125;</div></pre></td></tr></table></figure><p>make() 内置函数 来创建一个新map </p><h3 id="注释格式"><a href="#注释格式" class="headerlink" title="注释格式"></a>注释格式</h3><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">块注释</div><div class="line">*/</div><div class="line"><span class="comment">// 行注释</span></div></pre></td></tr></table></figure><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 正确</span></div><div class="line"><span class="keyword">if</span> expression &#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"><span class="comment"># 错误</span></div><div class="line"><span class="keyword">if</span> expression</div><div class="line">&#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"><span class="comment"># 则报错</span></div><div class="line"></div><div class="line">syntax <span class="keyword">error</span>: unexpected semicolon <span class="keyword">or</span> newline <span class="keyword">before</span> &#123;</div></pre></td></tr></table></figure><h3 id="后续复习"><a href="#后续复习" class="headerlink" title="后续复习"></a>后续复习</h3><ol><li>&lt;&lt; 运算符</li></ol>]]></content>
    
    <summary type="html">
    
      golang基础
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
      <category term="golang" scheme="//yeyute.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>golang 排序练习题学习</title>
    <link href="//yeyute.github.io/2017/03/03/golang-%E6%8E%92%E5%BA%8F%E7%BB%83%E4%B9%A0%E9%A2%98%E5%AD%A6%E4%B9%A0/"/>
    <id>//yeyute.github.io/2017/03/03/golang-排序练习题学习/</id>
    <published>2017-03-03T05:38:54.000Z</published>
    <updated>2017-10-10T12:10:16.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>练习题目来源于 go 语言编程  一书,程序自己测试完成通过</p></blockquote><p>我们将该函数分为两类：主程序和排序算法函数。每个排序算法都包装成一个静态库，虽然现在看起来似乎有些多此一举，但这只是为了顺便演示包之间的依赖方法<br>注：环境变量需要指定到该根目录执行程序，另外文章只是简单的说明构建流程，主要自己看代码理解</p><h3 id="目录结构代码-https-github-com-yeyute-go-git"><a href="#目录结构代码-https-github-com-yeyute-go-git" class="headerlink" title="目录结构代码 (https://github.com/yeyute/go.git)"></a>目录结构代码 (<a href="https://github.com/yeyute/go.git" target="_blank" rel="external">https://github.com/yeyute/go.git</a>)</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">├─<span class="symbol">&lt;src&gt;</span></div><div class="line">├─<span class="symbol">&lt;sorter&gt;</span></div><div class="line">├─sorter.<span class="keyword">go</span></div><div class="line">├─<span class="symbol">&lt;algorithms&gt;</span></div><div class="line">├─<span class="symbol">&lt;qsort&gt;</span></div><div class="line">├─qsort.<span class="keyword">go</span></div><div class="line">├─qsort_test.<span class="keyword">go</span></div><div class="line">├─<span class="symbol">&lt;bubblesort&gt;</span></div><div class="line">├─bubblesort.<span class="keyword">go</span></div><div class="line">├─bubblesort_test.<span class="keyword">go</span></div><div class="line">├─<span class="symbol">&lt;pkg&gt;</span>(程序构建时自动创建)</div><div class="line">├─<span class="symbol">&lt;bin&gt;</span>(程序构建时自动创建)</div></pre></td></tr></table></figure><a id="more"></a><p>其中sorter.go是主程序<br>qsort.go用于实现快速排序<br>bubblesort.go用于实现冒泡排序</p><h3 id="构建程序"><a href="#构建程序" class="headerlink" title="构建程序"></a>构建程序</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">go</span> build algorithm/qsort</div><div class="line">$ <span class="keyword">go</span> build algorithm/bubblesort</div><div class="line">$ <span class="keyword">go</span> test algorithm/qsort</div><div class="line">ok algorithm/qsort0<span class="number">.007s</span></div><div class="line">$ <span class="keyword">go</span> test algorithm/bubblesort</div><div class="line">ok algorithm/bubblesort0<span class="number">.013s</span></div><div class="line">$ <span class="keyword">go</span> install algorithm/qsort</div><div class="line">$ <span class="keyword">go</span> install algorithm/bubblesort</div><div class="line">$ <span class="keyword">go</span> build sorter</div><div class="line">$ <span class="keyword">go</span> install sorter</div></pre></td></tr></table></figure><p>执行安装这些命令，我们应该能够在src的同一级目录下看到两个目录——bin和pkg,然后在bin目录新建unsorted.dat，执行以下</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ cd bin</div><div class="line">$ vim unsorted.dat</div><div class="line"><span class="number">123</span></div><div class="line"><span class="number">3064</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="number">64</span></div><div class="line"><span class="number">490</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">23</span></div><div class="line"><span class="number">5331</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">7</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">132</span></div></pre></td></tr></table></figure><p>:wq 保存退出</p><p>再执行<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ ./sorter -<span class="selector-tag">i</span> unsorted<span class="selector-class">.dat</span> -o sorted<span class="selector-class">.dat</span> -<span class="selector-tag">a</span> qsort infile = unsorted<span class="selector-class">.dat</span> outfile = sorted<span class="selector-class">.dat</span> algorithm = qsort</div><div class="line">The sorting process costs <span class="number">3</span>us to complete.</div><div class="line">$ ./sorter -<span class="selector-tag">i</span> unsorted<span class="selector-class">.dat</span> -o sorted<span class="selector-class">.dat</span> -<span class="selector-tag">a</span> bubblesort infile = unsorted<span class="selector-class">.dat</span> outfile = sorted<span class="selector-class">.dat</span> algorithm = bubblesort</div><div class="line">The sorting process costs <span class="number">2</span>us to complete.</div><div class="line">$ cat sorted<span class="selector-class">.dat</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">7</span></div><div class="line"><span class="number">23</span></div><div class="line"><span class="number">64</span></div><div class="line"><span class="number">123</span></div><div class="line"><span class="number">132</span></div><div class="line"><span class="number">490</span></div><div class="line"><span class="number">3064</span></div><div class="line"><span class="number">5331</span></div></pre></td></tr></table></figure></p><p>结果已经被正确排序并写入到sorted.dat文件中,，至此我们的程序也算是完整了</p><blockquote><p>如果有您有帮助，请给个start</p></blockquote>]]></content>
    
    <summary type="html">
    
      golang 排序练习题学习
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="golang" scheme="//yeyute.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>golang 环境搭建笔记</title>
    <link href="//yeyute.github.io/2017/02/25/go-%E5%AE%89%E8%A3%85%E7%AC%94%E8%AE%B0/"/>
    <id>//yeyute.github.io/2017/02/25/go-安装笔记/</id>
    <published>2017-02-25T06:12:46.000Z</published>
    <updated>2017-10-10T12:10:06.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>下载地址：<a href="https://golang.org/dl/" target="_blank" rel="external">https://golang.org/dl/</a></p><h3 id="mac-安装"><a href="#mac-安装" class="headerlink" title="mac 安装"></a>mac 安装</h3><p>版本：1.8.1<br>MAC 系统下你可以使用 .pkg 结尾的安装包直接双击来完成安装，安装目录在 /usr/local/go/ 下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// 没有bash_profile 则新建</div><div class="line">vim ~/.bash_profile</div><div class="line"></div><div class="line"><span class="comment"># 项目路径</span></div><div class="line"><span class="built_in">export</span> GOPATH=/Users/AT/Dropbox/htdocs/go</div><div class="line"><span class="comment"># go执行的执行位置 默认是</span></div><div class="line"><span class="built_in">export</span> GOBIN=/usr/<span class="built_in">local</span>/go/bin</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$GOBIN</span></div><div class="line">:wq</div><div class="line"></div><div class="line"><span class="comment"># 编译</span></div><div class="line"><span class="built_in">source</span> .bash_profile</div><div class="line"><span class="comment"># 查看 go 环境变量是否成功</span></div><div class="line">go env</div></pre></td></tr></table></figure><a id="more"></a><h3 id="windows-安装"><a href="#windows-安装" class="headerlink" title="windows 安装"></a>windows 安装</h3><p>下载windodws对应的安装版本（msi结尾的），安装完成配置对应的环境变量即可<br>GOROOT: go的安装路径,官方包路径根据这个设置自动匹配<br>GOPATH: 工作路径(其实不应该用中文翻译解释，直接说GOPATH更合适)<br><img src="https://yeyute.github.io/assets/go_path.png" alt="配置环境变量"></p><h3 id="输出第一条语句"><a href="#输出第一条语句" class="headerlink" title="输出第一条语句"></a>输出第一条语句</h3><p>在环境变量 GOPATH的目录下新建 hello.go。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">fmt.Println(<span class="string">"Hello, World!"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>个人使用sublime的插件执行 </p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">go <span class="keyword">run</span><span class="bash"> hello.go</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      golang环境安装
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
      <category term="golang" scheme="//yeyute.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>Facade外观设计模式</title>
    <link href="//yeyute.github.io/2017/01/22/Facade%E5%A4%96%E8%A7%82%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <id>//yeyute.github.io/2017/01/22/Facade外观设计模式/</id>
    <published>2017-01-22T07:38:31.000Z</published>
    <updated>2017-10-10T12:09:49.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h3><p>用于全部api的统一调用方式，规范化代码，后续维护方便<br>具有独立性 和可移植性<br>在 apiImplement类 做接口接入的扩展，例： apiImplement类中的mango 方法 实例化 MangoApi类，调用方式如下</p><a id="more"></a><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Admin</span>\<span class="title">Controllers</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Libraries</span>\<span class="title">Api</span>;</div><div class="line"><span class="comment">// Api::mango() 实例化了 MangoApi类  requestUrl是MangoApi类的方法</span></div><div class="line">$rs = Api::mango($data[<span class="string">'api_info'</span>] , <span class="function"><span class="keyword">function</span> <span class="params">(MangoApi $MangoApi)</span> <span class="title">use</span> <span class="params">($data)</span>  </span>&#123;</div><div class="line">            $MangoApi-&gt;requestUrl($data[<span class="string">'api_info'</span>], $data[<span class="string">'data'</span>]);</div><div class="line">        &#125;);</div></pre></td></tr></table></figure><p>扩展规范<br>apiImplement类 添加对应的方法，去实例化需要的对象</p><p>以下是各文件的类<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// file Api.php </span></div><div class="line">namespace <span class="type">App</span>\<span class="type">Libraries</span>;</div><div class="line">use <span class="type">App</span>\<span class="type">Libraries</span>\<span class="type">Facade</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Api</span> <span class="keyword">extends</span> <span class="title">Facade</span> </span>&#123;</div><div class="line"></div><div class="line">static public function getFacadeAccessor() &#123;</div><div class="line"></div><div class="line"><span class="keyword">return</span> \<span class="type">App</span>\<span class="type">Libraries</span>\<span class="type">Api</span>\<span class="type">ApiImplement</span>::<span class="class"><span class="keyword">class</span></span>;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>Facade.php 通过__callStatic 方法来实现通用 </p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// file Facade.php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Libraries</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">RuntimeException</span>;</div><div class="line"></div><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Facade</span> </span>&#123;</div><div class="line"><span class="keyword">static</span> <span class="keyword">public</span> $resolvedInstance;</div><div class="line"><span class="keyword">static</span> <span class="keyword">public</span> $app;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * [getFacadeAccessor 获取访问器]</div><div class="line"> * <span class="doctag">@return</span> [type] [description]</div><div class="line"> */</div><div class="line"><span class="keyword">static</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFacadeAccessor</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'Facade does not implement getFacadeAccessor method.'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * [getInstance 获取实例]</div><div class="line"> * <span class="doctag">@return</span> [object] [instance]</div><div class="line"> */</div><div class="line"><span class="keyword">static</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFacadeRoot</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> <span class="keyword">static</span>::resolveFacadeInstance(<span class="keyword">static</span>::getFacadeAccessor());</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">resolveFacadeInstance</span><span class="params">($name)</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">if</span>( is_object($name) ) &#123;</div><div class="line"><span class="keyword">return</span> $name;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">static</span>::$resolvedInstance[$name])) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">static</span>::$resolvedInstance[$name];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">static</span>::$resolvedInstance[$name] = <span class="keyword">new</span> $name();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * [__callStatic ]</div><div class="line"> * <span class="doctag">@param</span>  [string] $method [调用的方法]</div><div class="line"> * <span class="doctag">@param</span>  [array] $args   [参数]</div><div class="line"> * <span class="doctag">@return</span> [mixed]         [mixed]</div><div class="line"> */</div><div class="line"><span class="keyword">static</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__callStatic</span><span class="params">($method,$args)</span> </span>&#123;</div><div class="line"></div><div class="line">$instance = <span class="keyword">self</span>::getFacadeRoot();</div><div class="line"></div><div class="line"><span class="keyword">if</span> (! $instance) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'A facade root has not been set.'</span>);</div><div class="line">        &#125;</div><div class="line">     </div><div class="line">        <span class="keyword">return</span> $instance-&gt;$method(...$args);</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ApiImplement.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//file ApiImplement.php</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Libraries</span>\<span class="title">Api</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">apiImplement</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * [mango ]</div><div class="line"> * <span class="doctag">@param</span>  [type]  $data     [description]</div><div class="line"> * <span class="doctag">@param</span>  Closure $callable [description]</div><div class="line"> * <span class="doctag">@return</span> [type]            [description]</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">mango</span><span class="params">($data, Closure $callable)</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">return</span> <span class="keyword">new</span> MangoApi($data, $callable); </div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>MangoApi 继承于基类 BaseApi， 初始化对应的接口信息，根据自己的需求进行优化<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Libraries</span>\<span class="title">Api</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Encore</span>\<span class="title">Admin</span>\<span class="title">Exception</span>\<span class="title">Handle</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MangoApi</span> <span class="keyword">extends</span> <span class="title">BaseApi</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> $callable;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [__construct 构造函数]</div><div class="line">     * <span class="doctag">@param</span> [type]  $api_info [一个api 信息对象]</div><div class="line">     * <span class="doctag">@param</span> Closure $callable     [description]</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($api_info,Closure $callback)</span></span></div><div class="line">    &#123;   </div><div class="line">        <span class="keyword">$this</span>-&gt;service_name         = $api_info-&gt;service_name;</div><div class="line">        <span class="comment">// // 必传的参数，用|分隔</span></div><div class="line">        <span class="keyword">$this</span>-&gt;params               = $api_info-&gt;params;</div><div class="line">        <span class="keyword">$this</span>-&gt;return_construction  = json_decode($api_info-&gt;return_construction,<span class="keyword">true</span>);</div><div class="line">        <span class="keyword">$this</span>-&gt;time                 = time();</div><div class="line">        <span class="keyword">$this</span>-&gt;callable             = $callback;</div><div class="line">        $callback(<span class="keyword">$this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Render the api contents.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> string</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;callable;</div><div class="line">        &#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> with(<span class="keyword">new</span> Handle($e))-&gt;render();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Get the string contents of the view.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> string</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;render();</div><div class="line">  </div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>BaseApi.php，可以做成api 的基类，统一继承，目前不可以通用，待改善<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// file BaseApi.php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Libraries</span>\<span class="title">Api</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Encore</span>\<span class="title">Admin</span>\<span class="title">Exception</span>\<span class="title">Handle</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Encore</span>\<span class="title">Admin</span>\<span class="title">Form</span>\<span class="title">Builder</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Curl</span>\<span class="title">Curl</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseApi</span> </span>&#123;</div><div class="line">    <span class="comment">// 接口的签名</span></div><div class="line">    <span class="keyword">protected</span> $sign;</div><div class="line">    <span class="comment">// 配置信息</span></div><div class="line">    <span class="keyword">protected</span> $config;</div><div class="line">    <span class="comment">// 请求的body 值 </span></div><div class="line">    <span class="keyword">protected</span> $body;</div><div class="line">    <span class="comment">// 请求的头部</span></div><div class="line">    <span class="keyword">protected</span> $header;</div><div class="line">    <span class="comment">// 接口的服务名</span></div><div class="line">    <span class="keyword">protected</span> $service_name;</div><div class="line">    <span class="comment">// 10 位的时间戳</span></div><div class="line">    <span class="keyword">protected</span> $time;</div><div class="line">    <span class="comment">// 必传的参数 默认值</span></div><div class="line">    <span class="keyword">protected</span> $params = <span class="string">"productId"</span>;</div><div class="line">    <span class="comment">// 错误码</span></div><div class="line">    <span class="keyword">protected</span> $code_config;</div><div class="line">    <span class="comment">// 接口返回的数据结构 默认是这个</span></div><div class="line">    <span class="keyword">protected</span> $return_construction = [</div><div class="line">                                        <span class="string">"Code"</span>    =&gt;<span class="number">0</span>,</div><div class="line">                                        <span class="string">"Message"</span> =&gt; <span class="string">"success"</span>,</div><div class="line">                                        <span class="string">"Result"</span>  =&gt;<span class="string">"&#123;data&#125;"</span>,</div><div class="line">                                    ];</div><div class="line">    <span class="keyword">public</span> $return_rs;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;config      = config(<span class="string">'product.api'</span>);</div><div class="line">        <span class="keyword">$this</span>-&gt;code_config = config(<span class="string">'product.error_code'</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [setHeaders 设置头部]</div><div class="line">     * <span class="doctag">@param</span> [type] $service_name [服务名]</div><div class="line">     * <span class="doctag">@param</span> [type] $time         [当前时间戳]</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">setHeaders</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        $header = [ <span class="comment">//组装请求体</span></div><div class="line">            <span class="string">"uid"</span>            =&gt;<span class="keyword">$this</span>-&gt;config[<span class="string">'uid'</span>],</div><div class="line">            <span class="string">"sid"</span>            =&gt;<span class="keyword">$this</span>-&gt;config[<span class="string">'sid'</span>],</div><div class="line">            <span class="string">"Data-Format"</span>    =&gt;<span class="string">"json"</span>,</div><div class="line">            <span class="string">"ServiceName"</span>    =&gt;<span class="keyword">$this</span>-&gt;service_name,</div><div class="line">            <span class="string">"Auth-Timestamp"</span> =&gt;<span class="keyword">$this</span>-&gt;time,</div><div class="line">            <span class="string">"Auth-Signature"</span> =&gt;<span class="keyword">$this</span>-&gt;sign,</div><div class="line">        ];</div><div class="line">        <span class="keyword">$this</span>-&gt;headers = $header;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;headers;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [setBody 设置body内容]</div><div class="line">     * <span class="doctag">@param</span> [type] $data [数据内容]</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">setBody</span><span class="params">($data)</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;body = $data;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;body;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"> </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [requestUrl 请求执行URL]</div><div class="line">     * <span class="doctag">@param</span>  [type] $post_json_data [body 请求的数据]</div><div class="line">     * <span class="doctag">@return</span> [type]                 [miax]</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">requestUrl</span><span class="params">($api_info ,$post_json_data)</span> </span>&#123;</div><div class="line">        <span class="comment">// 初始化配置</span></div><div class="line">        <span class="keyword">$this</span>-&gt;init($api_info);</div><div class="line">    </div><div class="line">        <span class="comment">// 检查参数 </span></div><div class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;checkParam($post_json_data) === <span class="keyword">false</span> ) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;code_config[<span class="string">'PARAM_ERROR'</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 设置签名</span></div><div class="line">        <span class="keyword">$this</span>-&gt;setSign($post_json_data);</div><div class="line">        <span class="comment">// 设置请求头部</span></div><div class="line">        <span class="keyword">$this</span>-&gt;setHeaders();</div><div class="line">        <span class="comment">// 设置请求body</span></div><div class="line">        <span class="keyword">$this</span>-&gt;setBody($post_json_data);</div><div class="line"></div><div class="line">        $curl = <span class="keyword">new</span> Curl();</div><div class="line">        $curl-&gt;setHeaders(<span class="keyword">$this</span>-&gt;headers);</div><div class="line"></div><div class="line">        $rs = $curl-&gt;post(<span class="keyword">$this</span>-&gt;config[<span class="string">'url'</span>],<span class="keyword">$this</span>-&gt;body);</div><div class="line">     </div><div class="line">        <span class="keyword">if</span> ($curl-&gt;error) &#123;</div><div class="line">            $data = [</div><div class="line">                <span class="string">'code'</span> =&gt; $curl-&gt;errorCode,</div><div class="line">                <span class="string">'msg'</span>  =&gt; <span class="string">'Error: '</span> . $curl-&gt;errorCode . <span class="string">': '</span> . $curl-&gt;errorMessage . <span class="string">"\n"</span>,</div><div class="line">            ];</div><div class="line">            <span class="keyword">return</span> $data;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">$this</span>-&gt;return_rs = <span class="keyword">$this</span>-&gt;code_config[<span class="string">'SUCCESS'</span>];</div><div class="line"></div><div class="line">        <span class="keyword">$this</span>-&gt;return_rs[<span class="string">'data'</span>] = <span class="keyword">$this</span>-&gt;getReturnData(<span class="keyword">$this</span>-&gt;return_construction, json_decode($rs, <span class="keyword">true</span>));</div><div class="line">        <span class="keyword">return</span>  <span class="keyword">$this</span>-&gt;return_rs;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [getReturnData 递归寻找数据那一层]</div><div class="line">     * <span class="doctag">@param</span>  [type] $return_construction[后台填写的数据结构]</div><div class="line">     * <span class="doctag">@param</span>  string $rs_data  [接口返回的数据 ]</div><div class="line">     * <span class="doctag">@param</span>  string $get_info [查询的内容]</div><div class="line">     * <span class="doctag">@return</span> [type]           []</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getReturnData</span><span class="params">($return_construction,  $rs_data, $get_info = <span class="string">'&#123;data&#125;'</span>)</span>  </span>&#123;</div><div class="line">        <span class="keyword">foreach</span>($return_construction <span class="keyword">as</span> $key=&gt;$val) &#123; </div><div class="line">            <span class="keyword">if</span>(is_array($val)) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getReturnData($val,$rs_data[$key]);</div><div class="line">            &#125;<span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">                <span class="keyword">if</span>($val === $get_info) &#123;</div><div class="line">                    <span class="keyword">return</span> $rs_data[$key];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="string">''</span>;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Get the string contents of the view.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> string</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;return_rs;</div><div class="line">  </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      php,外观设计模式，Facade
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="php" scheme="//yeyute.github.io/tags/php/"/>
    
      <category term="设计模式" scheme="//yeyute.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>laravel后台框架laravel-admin select框的使用</title>
    <link href="//yeyute.github.io/2016/12/15/laravel%E5%90%8E%E5%8F%B0%E6%A1%86%E6%9E%B6laravel-admin-select%E6%A1%86%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>//yeyute.github.io/2016/12/15/laravel后台框架laravel-admin-select框的使用/</id>
    <published>2016-12-15T04:01:59.000Z</published>
    <updated>2017-10-10T12:10:56.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="select-二级联动不能正常获取数据原因"><a href="#select-二级联动不能正常获取数据原因" class="headerlink" title="select 二级联动不能正常获取数据原因"></a>select 二级联动不能正常获取数据原因</h3><p><img src="https://yeyute.github.io/assets/laravel_admin1.png" alt="laravel_admin"><br>使用二级联动时调用的api时，api返回的代码如以下, </p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//控制器文件controller.php</span></div><div class="line"><span class="keyword">$this</span>-&gt;form-&gt;select(<span class="string">'sort'</span>, <span class="string">'app'</span>)</div><div class="line">             -&gt;options($sort_type)</div><div class="line">             -&gt;load(<span class="string">'position_id'</span>, <span class="string">'/admin/api_general/get_position'</span>);</div><div class="line"></div><div class="line"><span class="comment">//api文件                     </span></div><div class="line">$data = [</div><div class="line">&#123;<span class="string">"id"</span>=&gt;<span class="string">"111"</span>,<span class="string">"text"</span>=&gt;<span class="string">"index"</span>&#125;,</div><div class="line">];</div><div class="line"><span class="keyword">return</span> json_encode($data);</div></pre></td></tr></table></figure><p><img src="https://yeyute.github.io/assets/laravel_admin2.png" alt="laravel_admin"></p><a id="more"></a><p>头部信息的格式为 Content-type:text/html;</p><p> 即使在api文件补上header</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">header(<span class="string">"Content-type: application/json"</span>);</div><div class="line">$data = [</div><div class="line">&#123;<span class="string">"id"</span>=&gt;<span class="string">"111"</span>,<span class="string">"text"</span>=&gt;<span class="string">"index"</span>&#125;,</div><div class="line">];</div><div class="line"><span class="keyword">return</span> json_encode($data);</div></pre></td></tr></table></figure><p>结果还是返回Content-type:text/html; 类型</p><p>最后使用laravel封装方法解决问题</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$data = [</div><div class="line">&#123;<span class="string">"id"</span>=&gt;<span class="string">"111"</span>,<span class="string">"text"</span>=&gt;<span class="string">"index"</span>&#125;,</div><div class="line">];</div><div class="line"><span class="comment">// json 方法会自动将 Content-Type 头设置为 application/json，并使用 PHP 函数 json_encode 方法将给定数组转化为 JSON：</span></div><div class="line"><span class="keyword">return</span> response()-&gt;json($data);</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      php
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="php" scheme="//yeyute.github.io/tags/php/"/>
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>windows与linux安装node.js</title>
    <link href="//yeyute.github.io/2016/12/01/windows%E4%B8%8Elinux%E5%AE%89%E8%A3%85node-js/"/>
    <id>//yeyute.github.io/2016/12/01/windows与linux安装node-js/</id>
    <published>2016-12-01T08:03:11.000Z</published>
    <updated>2017-10-10T12:11:38.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="window-安装"><a href="#window-安装" class="headerlink" title="window 安装"></a>window 安装</h3><ol><li>安装git<br><a href="http://blog.csdn.net/shuyou612/article/details/53183683" target="_blank" rel="external">http://blog.csdn.net/shuyou612/article/details/53183683</a><br>官网安装过于慢的话可以考虑在 <a href="http://download.csdn.net/download/u010180815/9726804" target="_blank" rel="external">http://download.csdn.net/download/u010180815/9726804</a> 下载</li></ol><ol><li>下载并安装 Node.js 。使用其 LTS（长期支持）版本。 <a href="https://nodejs.org/en/download/" target="_blank" rel="external">https://nodejs.org/en/download/</a><br>windows 8以后的版本安装 msi 文件会 报 the installer has encountered…….. 2503 参考 <a href="http://jingyan.baidu.com/article/59a015e34f4870f79488652e.html" target="_blank" rel="external">http://jingyan.baidu.com/article/59a015e34f4870f79488652e.html</a></li></ol><a id="more"></a><p>现在开始安装相关环境<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// -g 代表全用户安装</div><div class="line">npm <span class="keyword">install</span> express -g</div><div class="line">npm <span class="keyword">install</span> jade -g </div><div class="line">npm <span class="keyword">install</span> mysql  -g</div></pre></td></tr></table></figure></p><h3 id="linux-centOS-安装"><a href="#linux-centOS-安装" class="headerlink" title="linux centOS 安装"></a>linux centOS 安装</h3><p>下载需要的版本 <a href="https://nodejs.org/en/download/" target="_blank" rel="external">https://nodejs.org/en/download/</a><br>参考 <a href="http://www.cnblogs.com/8765h/p/4777746.html" target="_blank" rel="external">http://www.cnblogs.com/8765h/p/4777746.html</a></p><h3 id="创建一个工程"><a href="#创建一个工程" class="headerlink" title="创建一个工程"></a>创建一个工程</h3><p>创建一个工程</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">express ship </div><div class="line">// 如运行<span class="keyword">cmd</span><span class="bash"> 时没有使用管理员身份运行，会报以下错误 </span></div><div class="line">// Error: EPERM:operation not permitted,mkdir <span class="string">'C:\Program Files\nodejs\ship'</span> at Error(native)</div></pre></td></tr></table></figure><p>如终端报错提示 express不是内部或外部命令<br>具体参数  <a href="http://jingyan.baidu.com/article/922554468a3466851648f419.html" target="_blank" rel="external">http://jingyan.baidu.com/article/922554468a3466851648f419.html</a></p><p>复制node_modules到ship下面进行测试</p><p>新建一个test.js 文件</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var http = require(<span class="string">"http"</span>);  </div><div class="line">http.createServer(<span class="keyword">function</span>(<span class="built_in">request</span>, <span class="built_in">response</span>) &#123;    </div><div class="line">    <span class="built_in">response</span>.writeHead(<span class="number">200</span>, &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>&#125;);    </div><div class="line">    <span class="built_in">response</span>.write(<span class="string">"Hello World"</span>);    </div><div class="line">    <span class="built_in">response</span>.<span class="keyword">end</span>();  </div><div class="line">&#125;).listen(<span class="number">8888</span>);  </div><div class="line">console.<span class="built_in">log</span>(<span class="string">"nodejs start listen 8888 port!"</span>);</div></pre></td></tr></table></figure><p> 终端 cd 到C:\Program Files\nodejs\ship 执行</p> <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">node</span> <span class="title">test</span>.js</div></pre></td></tr></table></figure><p> 浏览器访问 <a href="http://127.0.0.1:8888/" target="_blank" rel="external">http://127.0.0.1:8888/</a>  即可</p>]]></content>
    
    <summary type="html">
    
      nodejs
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
      <category term="nodejs" scheme="//yeyute.github.io/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>使用dockerfile 部署php环境</title>
    <link href="//yeyute.github.io/2016/11/03/%E4%BD%BF%E7%94%A8dockerfile-%E9%83%A8%E7%BD%B2php%E7%8E%AF%E5%A2%83/"/>
    <id>//yeyute.github.io/2016/11/03/使用dockerfile-部署php环境/</id>
    <published>2016-11-03T06:32:44.000Z</published>
    <updated>2017-10-10T12:08:58.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>该文章为学习docker 笔记一</p></blockquote><h3 id="docker-简介"><a href="#docker-简介" class="headerlink" title="docker 简介"></a>docker 简介</h3><p>Docker 是基于GO语言实现的开源容器项目，现在主流的Linux系统都支持Docker,Docker 的构想是想要实现“Build,Ship and Run Any App, Anywhere”,即通过对应用的封装（Packaging）、分发（Distribution）、部署（Deployment）、运行（Runtime）生命周期进行管理，达到应用组件“<strong><em>一次封装，到处运行</em></strong>”的目的。<br>简单的来说，可以将Docker容器理解为一种轻量级的沙盒（sandbox）.每个容器运行着一个应用，不同的容器相互隔离，容器之间也可以通过网络互相通信。且容器的创建和停止都十分快速，几乎跟创建和终止原生应用一致。</p><a id="more"></a><h3 id="为什么使用docker"><a href="#为什么使用docker" class="headerlink" title="为什么使用docker"></a>为什么使用docker</h3><ol><li>加速本地的开发和构建流程，容器可以在开发环境构建，然后轻松地提交到测试环境，并最终进入生产环境</li><li>能够在让独立的服务或应用程序在不同的环境中得到相同的运行结果</li><li>创建隔离的环境来进行测试</li><li>高性能、超大规划的宿主机部署,高效的资源利用，docker 容器不需要额外的虚拟化管理程序（虚拟机）</li><li>一次创建与配置，之后可以在任意地方，任意时间让应用正常的运行</li></ol><h3 id="各系统环境安装docker"><a href="#各系统环境安装docker" class="headerlink" title="各系统环境安装docker"></a>各系统环境安装docker</h3><p><strong>mac</strong><br>docker下载，官网下载太慢，网盘地址 <a href="https://pan.baidu.com/s/1i47ETj3" target="_blank" rel="external">https://pan.baidu.com/s/1i47ETj3</a> 密码: r76s</p><p>需要挂载的目录需要在  Docker -&gt; Preferences… -&gt; File Sharing  添加。<br>windows 7 安装 <a href="https://segmentfault.com/n/1330000008349110" target="_blank" rel="external">https://segmentfault.com/n/1330000008349110</a></p><p><strong>linux</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">sudo yum <span class="keyword">update</span></div><div class="line"></div><div class="line">sudo yum <span class="keyword">install</span> docker</div><div class="line">#安装程序将docker程序安装到/usr/<span class="keyword">bin</span>⺫⽬目录下，配置⽂文件安装在/etc/sysconfig/docker。安装好docker之后，可以 将docker加⼊入到启动服务组中 </div><div class="line">sudo systemctl <span class="keyword">enable</span> docker.service</div><div class="line"></div><div class="line">#手动启动docker服务器，使⽤用命令 sudo systemctl <span class="keyword">start</span> docker.service</div></pre></td></tr></table></figure><p>目录结构 github地址 <a href="https://github.com/yeyute/docker-lnmpr" target="_blank" rel="external">https://github.com/yeyute/docker-lnmpr</a> </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">docker_lnmpr</div><div class="line">├── mysql</div><div class="line">│   └── Dockerfile</div><div class="line">└── mysqld<span class="selector-class">.cnf</span></div><div class="line">├── nginx</div><div class="line">│   ├── Dockerfile</div><div class="line">│   ├── nginx<span class="selector-class">.conf</span></div><div class="line">│   └── vhost</div><div class="line">│       └── www<span class="selector-class">.texixi</span><span class="selector-class">.com</span><span class="selector-class">.conf</span></div><div class="line">├── php</div><div class="line">│   ├── Dockerfile</div><div class="line">│   ├── composer<span class="selector-class">.phar</span></div><div class="line">│   ├── php-fpm<span class="selector-class">.conf</span></div><div class="line">│   ├── php<span class="selector-class">.ini</span></div><div class="line">│   ├── redis-<span class="number">3.0</span>.<span class="number">0</span><span class="selector-class">.tgz</span></div><div class="line">└── redis</div><div class="line">    └── Dockerfile</div><div class="line">    └── redis.conf</div></pre></td></tr></table></figure><h3 id="建立镜像与容器"><a href="#建立镜像与容器" class="headerlink" title="建立镜像与容器"></a>建立镜像与容器</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># <span class="keyword">build</span></div><div class="line"><span class="symbol">docker</span> <span class="keyword">build </span>-t centos/nginx:<span class="built_in">v1</span>.<span class="number">11</span>.<span class="number">5</span> -v /www:/www -v /<span class="meta">data</span>:/<span class="meta">data</span>  ./nginx</div><div class="line"><span class="symbol">docker</span> <span class="keyword">build </span>-t centos/mysql:<span class="built_in">v5</span>.<span class="number">7</span> -v /<span class="meta">data</span>/mysql:/var/lib/mysql -v /<span class="meta">data</span>/logs/mysql:/var/log/mysql  ./mysql</div><div class="line"><span class="symbol">docker</span> <span class="keyword">build </span>-t centos/php:<span class="built_in">v7</span>.<span class="number">0</span>.<span class="number">12</span> -v /www:/www -v /<span class="meta">data</span>:/<span class="meta">data</span>  ./php</div><div class="line"><span class="symbol">docker</span> <span class="keyword">build </span>-t centos/redis:<span class="built_in">v3</span>.<span class="number">2</span>.<span class="number">6</span> -v /<span class="meta">data</span>:/<span class="meta">data</span>  ./redis</div><div class="line"></div><div class="line">#备注：这里选取了<span class="number">172</span>.<span class="number">172</span>.<span class="number">0</span>.<span class="number">0</span>网段，也可以指定其他任意空闲的网段</div><div class="line"><span class="symbol">docker</span> network create --<span class="keyword">subnet=172.171.0.0/16 </span>docker-at</div><div class="line"></div><div class="line"># run</div><div class="line"><span class="symbol">docker</span> run --name mysql57 --net docker-at --<span class="built_in">ip</span> <span class="number">172</span>.<span class="number">171</span>.<span class="number">0</span>.<span class="number">9</span> -d -p <span class="number">3306</span>:<span class="number">3306</span> -v /<span class="meta">data</span>/mysql:/var/lib/mysql -v /<span class="meta">data</span>/logs/mysql:/var/log/mysql -v /<span class="meta">data</span>/run/mysqlmysqld:/var/run/mysqld  -e MYSQL_ROOT_PASSWORD<span class="number">=123456</span> -<span class="keyword">it </span>centos/mysql:<span class="built_in">v5</span>.<span class="number">7</span></div><div class="line"><span class="symbol">docker</span> run --name redis326 --net docker-at --<span class="built_in">ip</span> <span class="number">172</span>.<span class="number">171</span>.<span class="number">0</span>.<span class="number">10</span> -d -p <span class="number">6379</span>:<span class="number">6379</span>  -v /<span class="meta">data</span>:/<span class="meta">data</span> -<span class="keyword">it </span>centos/redis:<span class="built_in">v3</span>.<span class="number">2</span>.<span class="number">6</span></div><div class="line"><span class="symbol">docker</span> run --name php7 --net docker-at --<span class="built_in">ip</span> <span class="number">172</span>.<span class="number">171</span>.<span class="number">0</span>.<span class="number">8</span> -d -p <span class="number">9000</span>:<span class="number">9000</span> -v /www:/www -v /<span class="meta">data</span>:/<span class="meta">data</span> --link mysql57:mysql57 --link redis326:redis326 -<span class="keyword">it </span>centos/php:<span class="built_in">v7</span>.<span class="number">0</span>.<span class="number">12</span> </div><div class="line"><span class="symbol">docker</span> run --name nginx11 --net docker-at --<span class="built_in">ip</span> <span class="number">172</span>.<span class="number">171</span>.<span class="number">0</span>.<span class="number">7</span> -p <span class="number">80</span>:<span class="number">80</span> -d -v /www:/www -v /<span class="meta">data</span>:/<span class="meta">data</span> --link php7:php7 -<span class="keyword">it </span>centos/nginx:<span class="built_in">v1</span>.<span class="number">11</span>.<span class="number">5</span></div></pre></td></tr></table></figure><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul><li>docker start 容器名（容器ID也可以）</li><li>docker stop 容器名（容器ID也可以）</li><li>docker run 命令加 -d 参数，docker 会将容器放到后台运行</li><li>docker ps 正在运行的容器</li><li>docker logs –tail 10 -tf 容器名    查看容器的日志文件,加-t是加上时间戳，f是跟踪某个容器的最新日志而不必读整个日志文件</li><li>docker top 容器名 查看容器内部运行的进程</li><li>docker exec -d 容器名 touch /etc/new_config_file  通过后台命令创建一个空文件</li><li>docker run –restart=always –name 容器名 -d ubuntu /bin/sh -c “while true;do echo hello world; sleep 1; done” 无论退出代码是什么，docker都会自动重启容器，可以设置 –restart=on-failure:5 自动重启的次数</li><li>docker inspect 容器名   对容器进行详细的检查，可以加 –format=’{(.State.Running)}’ 来获取指定的信息</li><li>docker rm 容器ID  删除容器，注，运行中的容器无法删除</li><li>docker rm <code>docker ps -a -q</code> 这样可以删除所有的容器</li><li>docker images 列出镜像</li><li>docker pull 镜像名:标签 拉镜像</li><li>docker search  查找docker Hub 上公共的可用镜像 </li><li>docker build -t=’AT/web_server:v1’  命令后面可以直接加上github仓库的要目录下存在的Dockerfile文件。 命令是编写Dockerfile 之后使用的。-t选项为新镜像设置了仓库和名称:标签</li><li>docker login  登陆到Docker Hub，个人认证信息将会保存到$HOME/.dockercfg, </li><li>docker commit -m=”comment “ –author=”AT”  容器ID 镜像的用户名/仓库名:标签 不推荐这种方法，推荐dockerfile</li><li>docker history 镜像ID 深入探求镜像是如何构建出来的</li><li>docker port 镜像ID 端口    查看映射情况的容器的ID和容器的端口号，假设查询80端口对应的映射的端口</li><li>run 运行一个容器，  -p 8080:80  将容器内的80端口映射到docker宿主机的某一特定端口，将容器的80端口绑定到宿主机的8080端口，另 127.0.0.1:80:80 是将容器的80端口绑定到宿主机这个IP的80端口上，-P 是将容器内的80端口对本地的宿主机公开</li><li><a href="http://docs.docker.com/reference/builder/" target="_blank" rel="external">http://docs.docker.com/reference/builder/</a> 查看更多的命令</li><li>docker push 镜像名 将镜像推送到 Docker Hub</li><li>docker rmi 镜像名  删除镜像</li><li>docker attach 容器ID   进入容器</li></ul><p><strong>删除所有容器和镜像的命令</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">docker</span> rm `docker ps -a |awk <span class="string">'&#123;print <span class="variable">$1</span>&#125;'</span> | grep [<span class="number">0</span>-9a-z]` 删除停止的容器</div><div class="line">docker rmi $(docker images | awk <span class="string">'/^&lt;none&gt;/ &#123; print <span class="variable">$3</span> &#125;'</span>)</div></pre></td></tr></table></figure><p><strong>进入容器的命令</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root<span class="symbol">@iZ287mq5dooZ</span> nginx]<span class="meta"># docker inspect --format <span class="string">"&#123;&#123; .State.Pid &#125;&#125;"</span> 54a454b827e5(容器ID)</span></div><div class="line"><span class="number">20426</span></div><div class="line">[root<span class="symbol">@iZ287mq5dooZ</span> nginx]<span class="meta"># nsenter --target 20426 --mount --uts --ipc --net --pid</span></div><div class="line">[root<span class="symbol">@bcb14764a7a3</span> /]<span class="meta">#</span></div></pre></td></tr></table></figure><h3 id="搭建私有仓库"><a href="#搭建私有仓库" class="headerlink" title="搭建私有仓库"></a>搭建私有仓库</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 使用官方提供的registry 镜像来简单的搭建本地仓库</span></div><div class="line"><span class="attribute">docker</span> run -d -p <span class="number">5000</span>:<span class="number">5000</span> -v /data/registry:/tmp/registry registry</div><div class="line"></div><div class="line"><span class="comment"># 标记镜像</span></div><div class="line">docker tag centos/mysql:v5.<span class="number">6</span> <span class="number">192.168.199.128:5000</span>/mysql56</div><div class="line"></div><div class="line"><span class="comment"># 上传镜像</span></div><div class="line">docker push <span class="number">192.168.199.128:5000</span>/mysql56</div><div class="line"></div><div class="line"><span class="comment"># 下载镜像</span></div><div class="line">docker pull <span class="number">192.168.199.128:5000</span>/mysql56</div></pre></td></tr></table></figure><h3 id="dockerfile-语法"><a href="#dockerfile-语法" class="headerlink" title="dockerfile 语法"></a>dockerfile 语法</h3><ul><li>MAINTAINER  标识镜像的作者和联系方式</li><li>EXPOSE 可以指定多个EXPOSE向外部公开多个端口，可以帮助多个容器链接</li><li>FROM   指令指定一个已经存在的镜像</li><li>#号代表注释</li><li>RUN 运行命令,会在shell 里使用命令包装器 /bin/sh -c 来执行。如果是在一个不支持shell 的平台上运行或者不希望在shell 中运行，也可以 使用exec 格式 的RUN指令</li><li>ENV REFRESHED_AT 环境变量 这个环境亦是用来表明镜像模板最后的更新时间</li><li>VOLUME 容器添加卷。一个卷是可以 存在于一个或多个容器内的特定的目录，对卷的修改是立刻生效的，对卷的修改不会对更新镜像产品影响，例:VOLUME[“/opt/project”,”/data”]</li><li>ADD 将构建环境 下的文件 和目录复制到镜像 中。例 ADD nginx.conf /conf/nginx.conf 也可以是取url 的地址文件，如果是压缩包，ADD命令会自动解压、</li><li>USER 指定镜像用那个USER 去运行</li><li>COPY 是复制本地文件，而不会去做文件提取（解压包不会自动解压） 例：COPY conf.d/ /etc/apache2/  将本地conf.d目录中的文件复制到/etc/apache2/目录中</li></ul><h3 id="问题点整理"><a href="#问题点整理" class="headerlink" title="问题点整理"></a>问题点整理</h3><ul><li><p><strong>docker 服务没启动</strong><br>启动并设置为开机自动启动docker服务</p>  <figure class="highlight livescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@iZ287mq5dooZ docker-php]<span class="comment"># docker info</span></div><div class="line">Cannot connect <span class="keyword">to</span> the Docker daemon. Is the docker daemon running <span class="literal">on</span> <span class="keyword">this</span> host?</div><div class="line">[root@iZ287mq5dooZ docker-php]<span class="comment"># ps aux | grep docker</span></div><div class="line">root      <span class="number">7902</span>  <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">112648</span>   <span class="number">956</span> pts/<span class="number">0</span>    S+   <span class="number">13</span>:<span class="number">54</span>   <span class="number">0</span>:<span class="number">00</span> grep --color=auto docker</div><div class="line">[root@iZ287mq5dooZ docker-php]<span class="comment"># service docker start</span></div><div class="line">Redirecting <span class="keyword">to</span> /bin/systemctl start  docker.service</div><div class="line">[root@iZ287mq5dooZ redis]<span class="comment"># systemctl start docker</span></div></pre></td></tr></table></figure></li><li><p><strong>注意挂载目录的权限问题，不然容器成功启动几秒后立刻关闭</strong><br>例：以下/data/run/mysql 目录没权限的情况下就会出现刚才那种情况</p><pre><code><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --name mysql57 -d -p <span class="number">3306</span>:<span class="number">3306</span> -v <span class="regexp">/data/</span><span class="string">mysql:</span><span class="regexp">/var/</span>lib<span class="regexp">/mysql -v /</span>data<span class="regexp">/logs/</span><span class="string">mysql:</span><span class="regexp">/var/</span>log<span class="regexp">/mysql -v /</span>data<span class="regexp">/run/</span><span class="string">mysql:</span><span class="regexp">/var/</span>run<span class="regexp">/mysqld -e MYSQL_ROOT_PASSWORD=123456 -it centos/</span><span class="string">mysql:</span>v5<span class="number">.7</span></div></pre></td></tr></table></figure></code></pre></li><li><p><strong>需要注意php.ini 中的目录对应  mysql 的配置的目录需要挂载才能获取文件内容，不然php连接mysql失败</strong></p><pre><code><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># php.ini</span></div><div class="line">mysql.default_socket = /data/<span class="keyword">run</span><span class="bash">/mysql/mysqld.sock</span></div><div class="line">mysqli.default_socket = /data/<span class="keyword">run</span><span class="bash">/mysql/mysqld.sock</span></div><div class="line">pdo_mysql.default_socket = /data/<span class="keyword">run</span><span class="bash">/mysql/mysqld.sock</span></div><div class="line"></div><div class="line"><span class="comment"># mysqld.cnf</span></div><div class="line">pid-file       = /var/<span class="keyword">run</span><span class="bash">/mysqld/mysqld.pid</span></div><div class="line">socket         = /var/<span class="keyword">run</span><span class="bash">/mysqld/mysqld.sock</span></div></pre></td></tr></table></figure></code></pre></li><li><p><strong>宿主机 无法访问docker的容器（nginx）</strong> <a href="https://segmentfault.com/q/1010000008893871，个人提问与回答都在里面" target="_blank" rel="external">https://segmentfault.com/q/1010000008893871，个人提问与回答都在里面</a></p></li><li><p><strong>使用php连接不上redis</strong> </p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 错误的</span></div><div class="line">$redis = <span class="keyword">new</span> Redis;</div><div class="line">$rs = $redis-&gt;connect(<span class="string">'127.0.0.1'</span>, <span class="number">6379</span>);</div></pre></td></tr></table></figure></li></ul><pre><code>php连接不上，查看错误日志<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">PHP Fatal <span class="string">error:</span>  Uncaught <span class="string">RedisException:</span> Redis server went away <span class="keyword">in</span> <span class="regexp">/www/</span>index.<span class="string">php:</span><span class="number">7</span></div></pre></td></tr></table></figure>考虑到docker 之间的通信应该不可以用127.0.0.1 应该使用容器里面的ip，所以查看redis 容器的ip<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@iZ287mq5dooZ php]# docker ps </div><div class="line">CONTAINER ID        IMAGE                  COMMAND                   CREATED             STATUS              PORTS                         NAMES</div><div class="line">5fb4b1904f1c        centos/nginx:v1<span class="meta">.11</span><span class="meta">.5</span>   <span class="string">"/usr/local/nginx/sbi"</span>    About an hour ago   <span class="meta">Up</span> About an hour    <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">80</span>-&gt;<span class="number">80</span>/tcp, <span class="number">443</span>/tcp   nginx11</div><div class="line">2bf7ad9f44f9        centos/php:v7<span class="meta">.0</span><span class="meta">.12</span>     <span class="string">"/usr/local/php/sbin/"</span>    About an hour ago   <span class="meta">Up</span> About an hour    <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">9000</span>-&gt;<span class="number">9000</span>/tcp        php7</div><div class="line">4b84858ea4e4        centos/redis:v3<span class="meta">.2</span><span class="meta">.6</span>    <span class="string">"/bin/sh -c '\"/usr/lo"</span>   <span class="number">18</span> hours ago        <span class="meta">Up</span> About an hour    <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">6379</span>-&gt;<span class="number">6379</span>/tcp        redis326</div><div class="line">158c67aa178c        centos/mysql:v5<span class="meta">.7</span>      <span class="string">"docker-entrypoint.sh"</span>    <span class="number">6</span> days ago          <span class="meta">Up</span> About an hour    <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">3306</span>-&gt;<span class="number">3306</span>/tcp        mysql57</div><div class="line">[root@iZ287mq5dooZ php]# docker inspect 4b84858ea4e4</div></pre></td></tr></table></figure>结果是为 192.168.0.4，测试连接，成功<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$redis = <span class="keyword">new</span> Redis;</div><div class="line">$rs = $redis-&gt;connect(<span class="string">'192.168.0.4'</span>, <span class="number">6379</span>);</div></pre></td></tr></table></figure>问题是重启容器ip为动态的，解决该问题第一步：创建自定义网络<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#备注：这里选取了<span class="number">172.172</span><span class="meta">.0</span><span class="meta">.0</span>网段，也可以指定其他任意空闲的网段</div><div class="line">docker network create --subnet=<span class="number">172.171</span><span class="meta">.0</span><span class="meta">.0</span>/<span class="number">16</span> docker-<span class="meta">at</span></div><div class="line">docker run --name redis326 --net docker-<span class="meta">at</span> --<span class="built_in">ip</span> <span class="number">172.171</span><span class="meta">.0</span><span class="meta">.10</span> -d -p <span class="number">6379</span>:<span class="number">6379</span>  -v /data:/data -it centos/redis:v3<span class="meta">.2</span><span class="meta">.6</span></div></pre></td></tr></table></figure>连接redis 就可以配置对应的ip地址了，连接成功<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$redis = <span class="keyword">new</span> Redis;</div><div class="line">$rs = $redis-&gt;connect(<span class="string">'172.171.0.10'</span>, <span class="number">6379</span>);</div></pre></td></tr></table></figure></code></pre><p>以上情况虽然容器之间关联了，但是容器之间的通讯需要用搭建的网段的连接。<br>假设：只有mysql 的容器，我们机器挂载了3306的端口，我们本地可以127.0.0.1去连接mysql容器服务<br>但是假设php服务也在容器里面，这时就不可以这么连接，因为是php容器去连接mysql容器，所以需要一个连接的ip。</p><ul><li><p><strong>使用docker-compose 报错</strong></p>  <figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 使用pip 安装docker-compose</span></div><div class="line">pip install -U docker-compose</div></pre></td></tr></table></figure><p>  假设没安装pip，会报以下错误，windows 请参数 <a href="http://www.cnblogs.com/RSsky/articles/5525999.html" target="_blank" rel="external">http://www.cnblogs.com/RSsky/articles/5525999.html</a></p>  <figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">bash:</span> <span class="string">pip:</span> command not found</div></pre></td></tr></table></figure><p>  linux 请执行</p>  <figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum <span class="keyword">install</span> python-pip</div></pre></td></tr></table></figure></li></ul><h3 id="安全检测工具"><a href="#安全检测工具" class="headerlink" title="安全检测工具"></a>安全检测工具</h3><p>Docker bench,clair 等</p><h3 id="镜像体积优化-目前个人使用的centos-没有做优化"><a href="#镜像体积优化-目前个人使用的centos-没有做优化" class="headerlink" title="镜像体积优化(目前个人使用的centos,没有做优化)"></a>镜像体积优化(目前个人使用的centos,没有做优化)</h3><ol><li>centos的基础镜像接近200m 可以考虑使用Alpine 的基础镜像，才4.999M</li><li>Docker 镜像的储存原理是分层的,docker build 的过程就是 docker 运行了一个容器，然后执行 Dockerfile 里写的命令。并且每一个命令都会 commit 一下，每一次 commit 都是一层一层的叠加在原来的镜像上，也就是说在某一层里增加了一个文件，在下一层里删除这个文件，是没有任何效果的，镜像体积是不变的，可能反而会增加</li></ol>]]></content>
    
    <summary type="html">
    
      docker,dockerfile,php,使用dockerfile 部署php环境
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
      <category term="docker" scheme="//yeyute.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>mysql 主从配置原理</title>
    <link href="//yeyute.github.io/2016/05/16/mysql-%E4%B8%BB%E4%BB%8E%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/"/>
    <id>//yeyute.github.io/2016/05/16/mysql-主从配置原理/</id>
    <published>2016-05-15T16:18:32.000Z</published>
    <updated>2017-10-10T12:11:05.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="复制概述"><a href="#复制概述" class="headerlink" title="复制概述"></a>复制概述</h3><ul><li>主服务器将更新写入二进制日志文件，并维护文件的一个索引以跟踪日志循环，这些日志可以记录发送到从服务器的更新。当一个从服务器连接主服务器时，从服务器在日志中读取的最后一次成功更新的位置</li></ul><h3 id="复制类型"><a href="#复制类型" class="headerlink" title="复制类型"></a>复制类型</h3><ul><li>基于语句的复制： 在主服务器上执行的SQL语句，在从服务器上执行同样的语句。MySQL默认采用基于语句的复制，效率比较高。一旦发现没法精确复制时，会自动选着基于行的复制。</li><li>基于行的复制：把改变的内容复制过去，而不是把命令在从服务器上执行一遍. 从mysql5.0开始支持 　　</li><li>混合类型的复制: 默认采用基于语句的复制，一旦发现基于语句的无法精确的复制时，就会采用基于行的复制。</li></ul><a id="more"></a><h3 id="复制解决的问题（-MySQL复制技术有以下一些特点-）"><a href="#复制解决的问题（-MySQL复制技术有以下一些特点-）" class="headerlink" title="复制解决的问题（ MySQL复制技术有以下一些特点 ）"></a>复制解决的问题（ MySQL复制技术有以下一些特点 ）</h3><ul><li>数据分布 (Data distribution)</li><li>负载平衡(load balancing)</li><li>备份(Backups)</li><li>高可用性和容错行 High availability and failover</li></ul><h3 id="复制如何工作"><a href="#复制如何工作" class="headerlink" title="复制如何工作"></a>复制如何工作</h3><ul><li>master将改变记录到二进制日志(binary log)中（这些记录叫做二进制日志事件，binary log events）；</li><li>slave将master的binary log events拷贝到它的中继日志(relay log)；</li><li>slave重做中继日志中的事件，将改变反映它自己的数据。</li></ul><h3 id="描述了复制的过程"><a href="#描述了复制的过程" class="headerlink" title="描述了复制的过程"></a>描述了复制的过程</h3><p>该过程的第一部分就是master记录二进制日志。在每个事务更新数据完成之前，master在二日志记录这些改变。<br>MySQL将事务串行的写入二进制日志，即使事务中的语句都是交叉执行的。<br>在事件写入二进制日志完成后，master通知存储引擎提交事务。<br>下一步就是slave将master的binary log拷贝到它自己的中继日志。<br>首先，slave开始一个工作线程——I/O线程。I/O线程在master上打开一个普通的连接，然后开始binlog dump process。Binlog dump process从master的二进制日志中读取事件，<br>如果已经跟上master，它会睡眠并等待master产生新的事件。I/O线程将这些事件写入中继日志。<br>SQL slave thread（SQL从线程）处理该过程的最后一步。SQL线程从中继日志读取事件，并重放其中的事件而更新slave的数据，使其与master中的数据一致。<br>只要该线程与I/O线程保持一致，中继日志通常会位于OS的缓存中，所以中继日志的开销很小。<br>此外，在master中也有一个工作线程：和其它MySQL的连接一样，slave在master中打开一个连接也会使得master开始一个线程。复制过程有一个很重要的限制——复制在slave上是串行化的，也就是说master上的并行更新操作不能在slave上并行操作。</p>]]></content>
    
    <summary type="html">
    
      mysql 主从配置原理
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="mysql" scheme="//yeyute.github.io/tags/mysql/"/>
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>适配器设计模式</title>
    <link href="//yeyute.github.io/2016/05/01/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    <id>//yeyute.github.io/2016/05/01/适配器模式/</id>
    <published>2016-05-01T15:44:52.000Z</published>
    <updated>2017-10-10T12:09:37.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="适配器的适用场景"><a href="#适配器的适用场景" class="headerlink" title="适配器的适用场景"></a>适配器的适用场景</h3><ul><li>代码的复用性强。</li><li>我们一直在使用适配器，如果 只有USB连接头，无法将手机插到标准的插座上面充电 ，这时需要的一个适配器，一端接USB连接头，另一端接插座</li><li>活动专题，例抽奖，固定的规则是充值有抽奖机会，但是突然来了一个需求说充值还要分享才能有抽奖机会，这时可以运用上这个设计模式</li></ul><p>题目一（来自于php 设计模式 书） - 假设一个企业网站同时销售软件服务和软件产品，目前所有的交易都在美国进行，后续业务决定向欧洲发展要增加货币换算（增加适配器）<br>题目二是自已设计于活动专题业务上，只是将逻辑摘取出来，代码不可直接运行</p><a id="more"></a><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li>灵活性扩展性都很好</li><li>将目标类和适配者类解耦</li></ol><h3 id="适配器所涉及的角色包括下面几种："><a href="#适配器所涉及的角色包括下面几种：" class="headerlink" title="适配器所涉及的角色包括下面几种："></a>适配器所涉及的角色包括下面几种：</h3><p>目标（Target）：定义一个客户端使用的特定接口。<br>客户端（Client）：使用目标接口，与和目标接口一致的对象合作。<br>被适配者（Adaptee）：一个现存需要适配的接口。<br>适配器（Adapter）：负责将Adaptee的接口转换为Target的接口。适配器是一个具体的类，这是该模式的核心。<br>适配器分为类适配器和对象适配器两种，下面将详细讲述。</p><h3 id="案例一"><a href="#案例一" class="headerlink" title="案例一"></a>案例一</h3><p>来自 php 设计模式 一书的适配器设计模式案例**<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * EuroCalc.php</div><div class="line"> * 美元 - 能累加购买的服务和产品的价格 来自于php 设计模式</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DollarCalc</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> $dollar;</div><div class="line">    <span class="keyword">private</span> $product;</div><div class="line">    <span class="keyword">private</span> $service;</div><div class="line">    <span class="keyword">public</span> $rate = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">requestCalc</span><span class="params">($productNow,$serviceNow)</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;product = $productNow;</div><div class="line">        <span class="keyword">$this</span>-&gt;service = $serviceNow;</div><div class="line">        <span class="keyword">$this</span>-&gt;dollar = <span class="keyword">$this</span>-&gt;product + <span class="keyword">$this</span>-&gt;service;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;requestCount();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">requestCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;dollar *= <span class="keyword">$this</span>-&gt;rate;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;dollar;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * EuroCalc.php</div><div class="line"> * 欧元 -  能累加购买的服务和产品的价格</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EuroCalc</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> $euro;</div><div class="line">    <span class="keyword">private</span> $product;</div><div class="line">    <span class="keyword">private</span> $service;</div><div class="line">    <span class="keyword">public</span> $rate = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">requestCalc</span><span class="params">($productNow,$serviceNow)</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;product = $productNow;</div><div class="line">        <span class="keyword">$this</span>-&gt;service = $serviceNow;</div><div class="line">        <span class="keyword">$this</span>-&gt;euro = <span class="keyword">$this</span>-&gt;product + <span class="keyword">$this</span>-&gt;service;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;requestCount();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">requestCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;euro *= <span class="keyword">$this</span>-&gt;rate;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;euro;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 接口 ITarget.php</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ITarget</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">requester</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 例：找一个合适的适配器来适合欧洲的插座一样，以下就是创建这个适配器</div><div class="line"> * EuroAdapter 实现了一个接口又扩展了一个类</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EuroAdapter</span> <span class="keyword">extends</span> <span class="title">EuroCalc</span> <span class="keyword">implements</span> <span class="title">ITarget</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;requester();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">requester</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;rate = <span class="number">0.8111</span>;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;rate;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 用户</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> $euroRequest;</div><div class="line">    <span class="keyword">private</span> $dollarRequest;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;euroRequest = <span class="keyword">new</span> EuroAdapter();</div><div class="line">        <span class="keyword">$this</span>-&gt;dollarRequest = <span class="keyword">new</span> DollarCalc();</div><div class="line"></div><div class="line">        $euros = <span class="string">"&amp;#8364;"</span>;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"Euros:$euros"</span>.<span class="keyword">$this</span>-&gt;makeAdapterRequest(<span class="keyword">$this</span>-&gt;euroRequest).<span class="string">"&lt;br /&gt;"</span>;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"dollar:"</span>.<span class="keyword">$this</span>-&gt;makeDollarRequest(<span class="keyword">$this</span>-&gt;dollarRequest);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">makeAdapterRequest</span><span class="params">(ITarget $req)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> $req-&gt;requestCalc(<span class="number">40</span>,<span class="number">50</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">makeDollarRequest</span><span class="params">(DollarCalc $req)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> $req-&gt;requestCalc(<span class="number">40</span>,<span class="number">50</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">$worker = <span class="keyword">new</span> Client();</div></pre></td></tr></table></figure></p><h3 id="案例二-个人运用于自动化活动专题的接口设计"><a href="#案例二-个人运用于自动化活动专题的接口设计" class="headerlink" title="案例二 个人运用于自动化活动专题的接口设计"></a>案例二 个人运用于自动化活动专题的接口设计</h3><p>抽奖例子（代码只显示对应的设计逻辑部分）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?php</span></span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 适配器模式 - 抽奖接口</div><div class="line"> * comment 当后台规则不满足自动化，可以添加对应的适配器，增加代码的复用</div><div class="line"> * author AT</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">controller</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 每个月份对应的适配器 06年3月 = SixMarch</span></div><div class="line"><span class="keyword">use</span> \<span class="title">Adapter</span>\<span class="title">SixMarch</span>\<span class="title">LotteryAdapter</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 抽奖接口 入口文件</div><div class="line"> */</div><div class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Lottery</span> <span class="keyword">extends</span> <span class="title">WebController</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// 活动的配置信息 存放后台配置的活动信息</span></div><div class="line">    <span class="keyword">private</span> $hd_info;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 加载配置信息</span></div><div class="line">        <span class="keyword">$this</span>-&gt;hd_info = <span class="string">''</span>; </div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_lottery</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// 实例</span></div><div class="line">        $lottery = <span class="keyword">new</span> LotteryAdapter($hd_info);</div><div class="line">        <span class="comment">// 取得抽奖结果</span></div><div class="line">        $rs      = $lottery-&gt;_getLotteryResult();</div><div class="line">        <span class="keyword">return</span> $rs;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">controller</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> \<span class="title">bbts</span>\<span class="title">App</span> <span class="title">as</span> <span class="title">BaseApp</span>;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * </div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LotteryAdapter</span> <span class="keyword">extends</span> <span class="title">AutoLottery</span> <span class="keyword">implements</span> <span class="title">ILottery</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($hd_info)</span> </span>&#123;</div><div class="line">        <span class="comment">// 后台配置是否需要使用适配器</span></div><div class="line">        <span class="keyword">if</span>($hd_info[<span class="string">'use_adapter'</span>] === <span class="keyword">true</span>) &#123;</div><div class="line">            $adapter_name = $hd_info[<span class="string">'adapter_name'</span>];</div><div class="line">            <span class="comment">// $adapter_name = 'adapter_name'; test</span></div><div class="line">            <span class="keyword">$this</span>-&gt;$adapter_name();</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * adapter_name 该活动对应的适配器</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">adapter_name</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// 假设不符合自动化的需求条件是必须进入游戏后5分才可抽奖，增加适配器的该内容即可，从而不用重写整个抽奖活动</span></div><div class="line">        $game_info = App::$app-&gt;model()-&gt;checkEnterGameInfo();</div><div class="line">        <span class="keyword">if</span>(strtotime($info[<span class="string">'TIME'</span>]) - time() &lt; <span class="number">300</span>) &#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;adapter_status = <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">$this</span>-&gt;adapter_code   = <span class="number">-51</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">controller</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> \<span class="title">bbts</span>\<span class="title">App</span> <span class="title">as</span> <span class="title">BaseApp</span>;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 自动化抽奖接口的基类</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoLottery</span> </span>&#123;</div><div class="line">     <span class="comment">// 单独开发条件的状态</span></div><div class="line">    <span class="keyword">public</span> $adapter_status = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">public</span> $adapter_code = <span class="number">0</span>;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_getLotteryResult</span><span class="params">()</span></span>&#123;</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//  最后判断适配器的状态</span></div><div class="line">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;adapter_status) &#123;</div><div class="line">            App::jetJsonpOutput(<span class="keyword">$this</span>-&gt;adapter_return_code);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// 业务逻辑判断</span></div><div class="line">        </div><div class="line">        <span class="comment">// 通过则将数据入库</span></div><div class="line">        $rs_status = App::$app-&gt;model()-&gt;insert($rs);</div><div class="line">       </div><div class="line">        <span class="comment">// 返回结果</span></div><div class="line">        <span class="keyword">return</span> $rs;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      php,适配器设计模式,设计模式
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="php" scheme="//yeyute.github.io/tags/php/"/>
    
      <category term="设计模式" scheme="//yeyute.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Redis-运用场景与介绍</title>
    <link href="//yeyute.github.io/2016/04/27/Redis-%E8%BF%90%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%8E%E4%BB%8B%E7%BB%8D/"/>
    <id>//yeyute.github.io/2016/04/27/Redis-运用场景与介绍/</id>
    <published>2016-04-27T13:38:58.000Z</published>
    <updated>2017-10-10T12:11:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>声明：该文章整理于公司redis培训的ppt</p><h3 id="redis-数据结构"><a href="#redis-数据结构" class="headerlink" title="redis 数据结构"></a>redis 数据结构</h3><ol><li>string(字符串)</li><li>list(双向链表)</li><li>set(无序集合)</li><li>zset(有序集合)</li><li>hash(hash表)</li><li>HyperLogLog</li></ol><a id="more"></a><h3 id="string-字符串-命令与运用场景"><a href="#string-字符串-命令与运用场景" class="headerlink" title="string(字符串) 命令与运用场景"></a>string(字符串) 命令与运用场景</h3><ul><li>除了get、set、incr、decr mget等操作外，Redis还提供了下面一些操作：</li><li>获取字符串长度 strlen</li><li>往字符串append内容的末尾</li><li>设置和获取字符串的某一段内容 GETRANGE </li><li>设置及获取字符串的某一位（bit）</li><li>批量设置一系列字符串的内容</li><li>GETSET 可以和 INCR 组合使用，实现一个有原子性(atomic)复位操作的计数器(counter)。</li></ul><p>运用场景防并发</p><pre><code><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 加锁，防并发</div><div class="line"> * <span class="doctag">@param</span> string $key</div><div class="line"> * <span class="doctag">@param</span> int $expire_time</div><div class="line"> * <span class="doctag">@return</span> Boolean</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">lock</span><span class="params">($key = <span class="string">''</span>, $expire_time = <span class="number">15</span>)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">''</span>===$key ? <span class="keyword">false</span> : <span class="keyword">self</span>::initConnection()-&gt;set($key, <span class="number">1</span>, <span class="keyword">array</span>(<span class="string">"NX"</span>, <span class="string">"EX"</span>=&gt;$expire_time));</div><div class="line">&#125;</div></pre></td></tr></table></figure></code></pre><ul><li>限制ip (访问超过几次)。INCRBY命令来控制次数，通过原子递增保持计数。</li></ul><h3 id="list-双向链表-命令与运用场景"><a href="#list-双向链表-命令与运用场景" class="headerlink" title="list(双向链表) 命令与运用场景"></a>list(双向链表) 命令与运用场景</h3><ul><li>lpush,rpush,lpop,rpop,lrange,BLPOP(阻塞版)等</li></ul><p>应用场景：</p><ul><li>Redis list的应用场景非常多，也是Redis最重要的数据结构之一。</li><li>我们可以轻松地实现最新消息排行等功能。</li><li>Lists的另一个应用就是消息队列，可以利用Lists的PUSH操作，将任务<br>存在Lists中，然后工作线程再用POP操作将任务取出进行执行</li><li>实现方式：</li><li>Redis list的实现为一个双向链表，即可以支持反向查找和遍历，更方便操作，不过带来了部分额外的内存开销，Redis内部的很多实现，包括，发送缓冲队列等也都是用的这个数据结构</li></ul><h3 id="数据结构-无序集合"><a href="#数据结构-无序集合" class="headerlink" title="数据结构- 无序集合"></a>数据结构- 无序集合</h3><p>常用命令：<br>sadd,srem,spop,sdiff ,smembers,sunion 等。</p><p>应用场景 </p><ul><li>set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以自动排重的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的。</li><li>比如在微博应用中，每个人的好友存在一个集合（set）中，这样求两个人的共<br>同好友的操作，可能就只需要用求交集命令即可。</li><li>Redis还为集合提供了求交集、并集、差集等操作，可以非常方便的实</li></ul><p>实现方式：</p><ul><li>set 的内部实现是一个 value永远为null的HashMap，实际就是通过计算hash的<br>方式来快速排重的，这也是set能提供判断一个成员是否在集合内的原因。</li></ul><h3 id="数据结构-有序集合"><a href="#数据结构-有序集合" class="headerlink" title="数据结构-有序集合"></a>数据结构-有序集合</h3><p>常用命令：</p><ul><li>zadd,zrange,zrem,zcard等</li></ul><p>使用场景：</p><ul><li>以某个条件为权重，比如按顶的次数排序.</li><li>ZREVRANGE命令可以用来按照得分来获取前100名的用户，ZRANK可以用来获取用户排名，非常直接而且操作容易。</li><li>Redis sorted set的使用场景与set类似，区别是set不是自动有序的，而sorted set可以通过用户额外提供一个优先级(score)的参数来为成员排序，并且是插入有序的，即自动排序。</li><li>比如:twitter 的public timeline可以以发表时间作为score来存储，这样获取时就是自动按时间排好序的。</li></ul><p>实现方式：</p><ul><li>Redis sorted set的内部使用HashMap和跳跃表(SkipList)来保证数据的存储和有序，HashMap<br>里放的是成员到score的映射，而跳跃表里存放的是所有的成员，排序依据是HashMap里存的score,<br>使用跳跃表的结构可以获得比较高的查找效率，并且在实现上比较简单</li></ul><h3 id="数据结构-hash-类型"><a href="#数据结构-hash-类型" class="headerlink" title="数据结构-hash 类型"></a>数据结构-hash 类型</h3><p>常用命令：</p><ul><li>hget,hset,hgetall 等。</li></ul><p>使用场景：</p><ol><li>根据业务场景存放用户信息等</li></ol><p>实现方式：</p><ul><li>上面已经说到Redis Hash对应Value内部实际就是一个HashMap，实际这里会有2种不同实现，这个Hash的成员比较少时Redis为了节省内存会采用类似一维数组的方式来紧凑存储，而不会采用真正的HashMap结构，对应的value redisObject的encoding为zipmap,当成员数量增大时会自动转成真正的HashMap,此时encoding为ht</li></ul><h3 id="数据结构-HyperLogLog"><a href="#数据结构-HyperLogLog" class="headerlink" title="数据结构-HyperLogLog"></a>数据结构-HyperLogLog</h3><ul><li>Redis HyperLogLog 是用来做基数统计的 算 法 ，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定 的、并且是很小的。</li><li>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基 数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</li><li>但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</li><li>注意事项：HyperLogLog是一种近似去重的算法，对于精度要求较高的业务场景，不能使用</li></ul><h3 id="命令总结"><a href="#命令总结" class="headerlink" title="命令总结"></a>命令总结</h3><h4 id="对value-操作的命令"><a href="#对value-操作的命令" class="headerlink" title="对value 操作的命令"></a>对value 操作的命令</h4><ul><li>exists(key)：确认一个key是否存在</li><li>del(key)：删除一个key</li><li>type(key)：返回值的类型</li><li>keys(pattern)：返回满足给定pattern的所有key</li><li>randomkey：随机返回key空间的一个key</li><li><strong>rename(oldname, newname)：将key由oldname重命名为newname，若newname存在则删除newname表示的key</strong></li><li>dbsize：返回当前数据库中key的数目</li><li>expire：设定一个key的活动时间（s）</li><li>ttl：获得一个key的活动时间</li><li>select(index)：按索引查询</li><li>move(key, dbindex)：将当前数据库中的key转移到有dbindex索引的数据库</li><li><strong>flushdb：删除当前选择数据库中的所有key</strong></li><li><strong>flushall：删除所有数据库中的所有key</strong></li></ul><h4 id="对String-操作的命令"><a href="#对String-操作的命令" class="headerlink" title="对String 操作的命令"></a>对String 操作的命令</h4><ul><li>set(key, value)：给数据库中名称为key的string赋予值value</li><li>get(key)：返回数据库中名称为key的string的value</li><li><strong>getset(key, value)：给名称为key的string赋予上一次的value</strong></li><li>mget(key1, key2,…, key N)：返回库中多个string（它们的名称为key1，key2…）的value</li><li><strong>setnx(key, value)：如果不存在名称为key的string，则向库中添加string，名称为key，值为value</strong></li><li><strong>setex(key, time, value)：向库中添加string（名称为key，值为value）同时，设定过期时间time</strong></li><li>mset(key1, value1, key2, value2,…key N, value N)：同时给多个string赋值，名称为key i的string赋值value i</li><li>msetnx(key1, value1, key2, value2,…key N, value N)：如果所有名称为key i的string都不存在，则向库中添加string，名称key i赋值为value i</li><li>incr(key)：名称为key的string增1操作</li><li>incrby(key, integer)：名称为key的string增加integer</li><li>decr(key)：名称为key的string减1操作</li><li>decrby(key, integer)：名称为key的string减少integer</li><li>append(key, value)：名称为key的string的值附加value</li><li>substr(key, start, end)：返回名称为key的string的value的子串</li></ul><h4 id="对List-操作的命令"><a href="#对List-操作的命令" class="headerlink" title="对List 操作的命令"></a>对List 操作的命令</h4><ul><li>rpush(key, value)：在名称为key的list尾添加一个值为value的元素</li><li>lpush(key, value)：在名称为key的list头添加一个值为value的 元素</li><li>llen(key)：返回名称为key的list的长度</li><li>lrange(key, start, end)：返回名称为key的list中start至end之间的元素（下标从0开始，下同）</li><li>ltrim(key, start, end)：截取名称为key的list，保留start至end之间的元素</li><li><strong>lindex(key, index)：返回名称为key的list中index位置的元素</strong></li><li>lset(key, index, value)：给名称为key的list中index位置的元素赋值为value</li><li>lrem(key, count, value)：删除count个名称为key的list中值为value的元素。count为0，删除所有值为value的元素，count&gt;0从头至尾删除count个值为value的元素，count&lt;0从尾到头删除|count|个值为value的元素。</li><li>lpop(key)：返回并删除名称为key的list中的首元素</li><li>rpop(key)：返回并删除名称为key的list中的尾元素</li><li>blpop(key1, key2,… key N, timeout)：lpop命令的block版本。即当timeout为0时，若遇到名称为key i的list不存在或该list为空，则命令结束。如果timeout&gt;0，则遇到上述情况时，等待timeout秒，如果问题没有解决，则对key i+1开始的list执行pop操作。</li><li>brpop(key1, key2,… key N, timeout)：rpop的block版本。参考上一命令。</li><li>rpoplpush(srckey, dstkey)：返回并删除名称为srckey的list的尾元素，并将该元素添加到名称为dstkey的list的头部</li></ul><h4 id="对Set-操作的命令"><a href="#对Set-操作的命令" class="headerlink" title="对Set 操作的命令"></a>对Set 操作的命令</h4><ul><li>sadd(key, member)：向名称为key的set中添加元素member</li><li>srem(key, member) ：删除名称为key的set中的元素member</li><li>spop(key) ：随机返回并删除名称为key的set中一个元素</li><li>smove(srckey, dstkey, member) ：将member元素从名称为srckey的集合移到名称为dstkey的集合</li><li>scard(key) ：返回名称为key的set的基数</li><li>sismember(key, member) ：测试member是否是名称为key的set的元素</li><li>sinter(key1, key2,…key N) ：求交集</li><li>sinterstore(dstkey, key1, key2,…key N) ：求交集并将交集保存到dstkey的集合</li><li>sunion(key1, key2,…key N) ：求并集</li><li>sunionstore(dstkey, key1, key2,…key N) ：求并集并将并集保存到dstkey的集合</li><li><strong>sdiff(key1, key2,…key N) ：求差集</strong></li><li>sdiffstore(dstkey, key1, key2,…key N) ：求差集并将差集保存到dstkey的集合</li><li>smembers(key) ：返回名称为key的set的所有元素</li><li>srandmember(key) ：随机返回名称为key的set的一个元素</li></ul><h4 id="对zset-（sorted-set-）操作的命令"><a href="#对zset-（sorted-set-）操作的命令" class="headerlink" title="对zset （sorted set ）操作的命令"></a>对zset （sorted set ）操作的命令</h4><ul><li>zadd(key, score, member)：向名称为key的zset中添加元素member，score用于排序。如果该元素已经存在，则根据score更新该元素的顺序。</li><li>zrem(key, member) ：删除名称为key的zset中的元素member</li><li>zincrby(key, increment, member) ：如果在名称为key的zset中已经存在元素member，则该元素的score增加increment；否则向集合中添加该元素，其score的值为increment</li><li>zrank(key, member) ：返回名称为key的zset（元素已按score从小到大排序）中member元素的rank（即index，从0开始），若没有member元素，返回“nil”</li><li>zrevrank(key, member) ：返回名称为key的zset（元素已按score从大到小排序）中member元素的rank（即index，从0开始），若没有member元素，返回“nil”</li><li>zrange(key, start, end)：返回名称为key的zset（元素已按score从小到大排序）中的index从start到end的所有元素</li><li>zrevrange(key, start, end)：返回名称为key的zset（元素已按score从大到小排序）中的index从start到end的所有元素</li><li>zrangebyscore(key, min, max)：返回名称为key的zset中score &gt;= min且score&lt;= max的所有元素</li><li>zcard(key)：返回名称为key的zset的基数</li><li>zscore(key, element)：返回名称为key的zset中元素element的score</li><li>zremrangebyrank(key, min, max)：删除名称为key的zset中rank &gt;= min且rank &lt;= max的所有元素</li><li>zremrangebyscore(key, min, max) ：删除名称为key的zset中score &gt;= min且score &lt;= max的所有元素</li><li>zunionstore / zinterstore(dstkeyN, key1,…,keyN,WEIGHTS w1,…wN, AGGREGATE SUM|MIN|MAX)：对N个zset求并集和交集，并将最后的集合保存在dstkeyN中。对于集合中每一个元素的score，在进行AGGREGATE运算前，都要乘以对于的WEIGHT参数。如果没有提供WEIGHT，默认为1。默认的AGGREGATE是SUM，即结果集合中元素的score是所有集合对应元素进行SUM运算的值，而MIN和MAX是指，结果集合中元素的score是所有集合对应元素中最小值和最大值。</li></ul><h4 id="对Hash-操作的命令"><a href="#对Hash-操作的命令" class="headerlink" title="对Hash 操作的命令"></a>对Hash 操作的命令</h4><ul><li>hset(key, field, value)：向名称为key的hash中添加元素field&lt;—&gt;value</li><li>hget(key, field)：返回名称为key的hash中field对应的value</li><li>hmget(key, field1, …,field N)：返回名称为key的hash中field i对应的value</li><li>hmset(key, field1, value1,…,field N, value N)：向名称为key的hash中添加元素field i&lt;—&gt;value i</li><li>hincrby(key, field, integer)：将名称为key的hash中field的value增加integer</li><li>hexists(key, field)：名称为key的hash中是否存在键为field的域</li><li>hdel(key, field)：删除名称为key的hash中键为field的域</li><li>hlen(key)：返回名称为key的hash中元素个数</li><li>hkeys(key)：返回名称为key的hash中所有键</li><li>hvals(key)：返回名称为key的hash中所有键对应的value</li><li>hgetall(key)：返回名称为key的hash中所有的键（field）及其对应的value</li></ul><h4 id="对HyperLogLog-操作的命令"><a href="#对HyperLogLog-操作的命令" class="headerlink" title="对HyperLogLog 操作的命令"></a>对HyperLogLog 操作的命令</h4><ul><li>pfadd (key, value…)，向名称为key的hyploglog结构中增<br>加value元素，返回boolean，true为已存在，false为不存<br>在。注意：不能使用返回结果做累加统计元素数量</li><li>pfcount (key)，返回名称为key的hyploglog结构中元素<br>的数量</li><li>pfmerge (key…) 合并多个hyploglog</li></ul><h3 id="php-与redis"><a href="#php-与redis" class="headerlink" title="php 与redis"></a>php 与redis</h3><ul><li>predis扩展</li><li>phpredis包</li></ul><h4 id="对比："><a href="#对比：" class="headerlink" title="对比："></a>对比：</h4><ul><li>predis非侵入时，性能更好</li><li>phpredis，php编写，效率低于predis，无序安装扩展，支持composer</li><li>如何选择？更多的是个人习惯和团队规范</li></ul><h3 id="应用场景-队列"><a href="#应用场景-队列" class="headerlink" title="应用场景- 队列"></a>应用场景- 队列</h3><ul><li>使用redis链表，lpush/rpush和rpop/lpop操作链表实现队列进出</li><li>最佳实践：启用AOF持久化，批量入队列，批量取队列</li></ul><p>场景：</p><ul><li>分布式进程通信、配置分发</li><li>示例：<a href="https://github.com/huyanping/RedisStudy" target="_blank" rel="external">https://github.com/huyanping/RedisStudy</a></li><li>问题：在大多队列的应用场景中，生产者的速度往往都会大于消费者的速度，如果保证队列不堆积？</li></ul><h3 id="应用场景-缓存"><a href="#应用场景-缓存" class="headerlink" title="应用场景- 缓存"></a>应用场景- 缓存</h3><ul><li>使用字典结构，通过set/get，hset/hget操作缓存数据</li><li>最佳实践：启用maxmemory限制，启用lru机制，设置expire，关闭AOF，考虑关闭dump</li></ul><p>场景：</p><ul><li>数据库缓存-减少响应时间</li><li>爬虫页面结果缓存-节省IO资源</li><li>计算结果缓存-节省CPU资源</li></ul><h3 id="应用场景-归并计算"><a href="#应用场景-归并计算" class="headerlink" title="应用场景- 归并计算"></a>应用场景- 归并计算</h3><ul><li>使用string类型，进行increment计数操作，减轻CPU或IO负载</li><li>最佳实践：启用AOF，关闭dump，批量操作</li></ul><p>场景:</p><ul><li>广告日志实时处理中心</li></ul><h3 id="应用场景-去重"><a href="#应用场景-去重" class="headerlink" title="应用场景- 去重"></a>应用场景- 去重</h3><ul><li>使用HyperLogLog进行IP去重</li><li>最佳实践：启用dump，关闭AOF，批量操作，巧用dabase<br>场景：</li><li>广告实时处理中心唯一IP统计</li></ul><h3 id="redis-lua"><a href="#redis-lua" class="headerlink" title="redis-lua"></a>redis-lua</h3><ul><li>Lua 脚本功能是 Reids 2.6 版本的最大亮点， 通过内嵌对 Lua 环境的支持， Redis 解决了长久以来不能高效地处理 CAS （check-and-set）命令的缺点， 并且可以通过组合使用多个命令， 轻松实现以前很难实现或者不能高效实现的模式。</li><li>优点：原子性，更小的请求包</li><li>应用场景：事务实现，批量处理</li></ul><h4 id="命令："><a href="#命令：" class="headerlink" title="命令："></a>命令：</h4><ul><li>EVAL script numkeys key [key …] arg [arg …]</li><li>script： 参数是一段 Lua 5.1 脚本程序。脚本不必(也不应该)定义为一个 Lua 函数。</li><li>numkeys： 用于指定键名参数的个数。</li><li>key [key …]： 从 EVAL 的第三个参数开始算起，表示在脚本中所用到的那些 Redis 键(key)，这些键名参数可以在 Lua 中通过全局变量 KEYS 数组，用 1 为基址的形式访问( KEYS[1] ，KEYS[2] ，以此类推)。</li><li>arg [arg …]： 附加参数，在 Lua 中通过全局变量 ARGV 数组访问，访问的形式和 KEYS 变量类似( ARGV[1] 、 ARGV[2] ，诸如此类)。</li><li>EVALSHA sha1 numkeys key [key …] arg [arg …]</li><li>script： 参数是一段 Lua 5.1 脚本程序。脚本不必(也不应该)定义为一个 Lua 函数。</li><li>numkeys： 用于指定键名参数的个数。</li><li>key [key …]： 从 EVAL 的第三个参数开始算起，表示在脚本中所用到的那些 Redis 键(key)，这些键名参数可以在 Lua 中通过全局变量 KEYS数组，用 1 为基址的形式访问( KEYS[1] ， KEYS[2] ，以此类推)。</li><li>arg [arg …]： 附加参数，在 Lua 中通过全局变量 ARGV 数组访问，访问的形式和 KEYS 变量类似( ARGV[1] 、 ARGV[2] ，诸如此类)。</li><li>SCRIPT LOAD “return ‘hello moto’”</li><li>EVALSHA “232fd51614574cf0867b83d384a5e898cfd24e5a” 0</li></ul><h3 id="故障-dump-故障"><a href="#故障-dump-故障" class="headerlink" title="故障-dump 故障"></a>故障-dump 故障</h3><ul><li>故障描述：redis使用dump持久化，未设置最大内存限制，dump时内存瞬时增加，大量使用swap分区，造成机器假死宕机</li><li>原因：redis使用dump持久化时，使用fork，子进程持有父进程内存的映像，在数据频繁更改的情况下，内存使用量会翻倍，内存不够的情况下，操作系统会使用swap分区。</li><li>经验：系统剩余内存不足redis占用内存2/3时，就会比较危险了</li><li>解决方案：设置maxmemroy，考虑启用lru，考虑关闭dump</li></ul><h3 id="故障-maxmemory"><a href="#故障-maxmemory" class="headerlink" title="故障-maxmemory"></a>故障-maxmemory</h3><ul><li>故障描述：设置了maxmemory，内存用完，客户端无法写入</li><li>解决方案：监控，根据业务场景控制内存使用；引入分布式redis集群方案</li></ul><h3 id="安全-redis-访问漏洞"><a href="#安全-redis-访问漏洞" class="headerlink" title="安全-redis 访问漏洞"></a>安全-redis 访问漏洞</h3><p>现象：服务器.ssh/authorized_keys文件被篡改，黑客最高可获得root权限，服务器被种木马<br>原理：利用 Redis 自身的提供的 config 命令，可以进行写文件操作，攻击者可以成功将自己的公钥写入目标服务器的 /root/.ssh 文件夹的authotrized_keys 文件中，进而可以直接使用对应的私钥登录目标服务器。<br>危害：数以万计的服务器被黑<br>如何避免：防火墙，密码访问</p>]]></content>
    
    <summary type="html">
    
      Redis,运用场景与介绍
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
      <category term="Redis" scheme="//yeyute.github.io/tags/Redis/"/>
    
      <category term="nosql" scheme="//yeyute.github.io/tags/nosql/"/>
    
  </entry>
  
  <entry>
    <title>状态设计模式</title>
    <link href="//yeyute.github.io/2016/04/12/%E7%8A%B6%E6%80%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <id>//yeyute.github.io/2016/04/12/状态设计模式/</id>
    <published>2016-04-12T14:59:32.000Z</published>
    <updated>2017-10-10T12:09:22.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="什么时候适用状态设计模式"><a href="#什么时候适用状态设计模式" class="headerlink" title="什么时候适用状态设计模式"></a>什么时候适用状态设计模式</h3><ul><li>有大量的判断状态的条件</li><li>状态模式的作用就是允许对象在状态改变时改变其行为，所以根据业务需求进行分析。</li></ul><h3 id="最基本的场景例子-比起全部判断语句的做法，这不是更好么"><a href="#最基本的场景例子-比起全部判断语句的做法，这不是更好么" class="headerlink" title="最基本的场景例子(比起全部判断语句的做法，这不是更好么)"></a>最基本的场景例子(比起全部判断语句的做法，这不是更好么)</h3><ul><li>开灯关灯</li><li>扩展 开灯-&gt;加亮-&gt;再加亮-&gt;关灯</li><li>九宫格的数字移动游戏</li></ul><a id="more"></a><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul><li>它将与特定状态相关的行为局部化，并且将不同状态的行为分割开来:</li><li>代码清晰可见，扩展性好</li></ul><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul><li>状态模式的使用必然会增加系统类和对象的个数。</li></ul><p><strong>只做开灯关灯例子说明 学习于php 设计模式（强烈推荐这本书）</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * content.class.php</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">content</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> $onState;</div><div class="line">    <span class="keyword">private</span> $offState;</div><div class="line">    <span class="keyword">private</span> $currentState;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;onState      = <span class="keyword">new</span> OnState(<span class="keyword">$this</span>);</div><div class="line">        <span class="keyword">$this</span>-&gt;offState     = <span class="keyword">new</span> offState(<span class="keyword">$this</span>);</div><div class="line">        <span class="keyword">$this</span>-&gt;currentState = <span class="keyword">$this</span>-&gt;offState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [trueOnLight 开灯]</div><div class="line">     * <span class="doctag">@return</span> [type] [description]</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">trueOnLight</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;currentState-&gt;onLight();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [trueOffLight 关灯]</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">trueOffLight</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;currentState-&gt;offLight();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [getState 取得关灯的实例]</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getOffState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;offState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [getOnState 取得开灯实例]</div><div class="line">     * <span class="doctag">@return</span> [type] [description]</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getOnState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;onState;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [setState 设置当前的实例]</div><div class="line">     * <span class="doctag">@param</span> Istate $state [description]</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setState</span><span class="params">(Istate $state)</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;currentState = $state;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 接口 IState.php</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">interface</span>  <span class="title">IState</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">onLight</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">offLight</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 开灯状态 OnState.class.php</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnState</span> <span class="keyword">implements</span> <span class="title">IState</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> $content;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Content $content)</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;content =  $content;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [onLight 开灯行为方法]</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onLight</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'已经开灯了&lt;br /&gt;'</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [offLight 关灯行为方法]</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offLight</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">$this</span>-&gt;content-&gt;setState(<span class="keyword">$this</span>-&gt;content-&gt;getOffState());</div><div class="line">        <span class="keyword">return</span> <span class="string">'关灯了&lt;br /&gt;'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 关灯状态 OffState.class.php</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">OffState</span> <span class="keyword">implements</span> <span class="title">IState</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> $content;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Content $content)</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;content = $content;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [onLight 开灯行为方法]</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onLight</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;content-&gt;setState(<span class="keyword">$this</span>-&gt;content-&gt;getOnState());</div><div class="line">        <span class="keyword">return</span> <span class="string">'开灯了&lt;br /&gt;'</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * [offLight 关灯行为方法]</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offLight</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'已经关灯了&lt;br /&gt;'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 用户调用用例 </div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">client</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> $content;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;content = <span class="keyword">new</span> content();</div><div class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;content-&gt;trueOnLight();</div><div class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;content-&gt;trueOnLight();</div><div class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;content-&gt;trueOffLight();</div><div class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;content-&gt;trueOffLight();<span class="keyword">exit</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$client = <span class="keyword">new</span> client();</div><div class="line"><span class="meta">?&gt;</span></div><div class="line"><span class="comment">/** </span></div><div class="line"> * 实例化一个Context 实例之后，初始请求是打开灯，因为灯默认是关的 ，请求显示的结果如下</div><div class="line"> * 开灯了</div><div class="line"> * 已经开灯了</div><div class="line"> * 关灯了</div><div class="line"> * 已经关灯了</div><div class="line"> */</div></pre></td></tr></table></figure></p><blockquote><p>每一个行动中，我们必须把目光放到我们的过去、现在和将来的行动之外，<br>还要超越这些行为影响到的其他人，而看到所有这一切之间的关系，<br>这样一来，我们就会非常的谨慎</p></blockquote>]]></content>
    
    <summary type="html">
    
      php,状态设计模式,设计模式
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="php" scheme="//yeyute.github.io/tags/php/"/>
    
      <category term="设计模式" scheme="//yeyute.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>单例模式</title>
    <link href="//yeyute.github.io/2016/04/11/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <id>//yeyute.github.io/2016/04/11/单例模式/</id>
    <published>2016-04-11T12:04:54.000Z</published>
    <updated>2017-10-10T12:09:05.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="单例模式的特点"><a href="#单例模式的特点" class="headerlink" title="单例模式的特点"></a>单例模式的特点</h3><ul><li>只能有一个实例</li><li>必须自行创建这个实例</li><li>必须给其他对象提供这一实例</li></ul><a id="more"></a><h3 id="单例类"><a href="#单例类" class="headerlink" title="单例类"></a>单例类</h3><ul><li>构造函数需要标记为private（访问控制：防止外部代码使用new操作符创建对象），单例类不能在其他类中实例化，只能被其自身实例化；</li><li>拥有一个保存类的实例的静态成员变量(非成静态员：所有没有加Static的成员都是非静态成员,当类被实例化之后,可以通过实例化的类名进行访问..非静态成员的生存期决定于该类的生存期..而静态成员则不存在生存期的概念,因为静态成员始终驻留在内容中..)</li><li>拥有一个访问这个实例的公共的静态方法（常用getInstance()方法进行实例化单例类，通过instanceof操作符可以检测到类是否已经被实例化）</li></ul><h3 id="为什么要使用PHP单例模式？"><a href="#为什么要使用PHP单例模式？" class="headerlink" title="为什么要使用PHP单例模式？"></a>为什么要使用PHP单例模式？</h3><ul><li>虽然PHP每次执行完页面都是会从内存中清理掉所有的资源. 因而PHP中的单例实际每次运行都是需要重新实例化的，但PHP一个主要应用场合就是应用程序与数据库打交道的场景，在一个应用中会存在大量的数据库操作，针对数据库句柄连接数据库的行为，使用单例模式可以避免大量的new操作。因为每一次new操作都会消耗系统和内存的资源。</li></ul><h3 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h3><ul><li>改进系统的设计</li><li>是对全局变量的一种改进</li></ul><h3 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h3><ul><li>难于调试</li><li>隐藏的依赖关系</li><li>无法用错误类型的数据覆写一个单例</li></ul>]]></content>
    
    <summary type="html">
    
      php,单例模式,设计模式
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="php" scheme="//yeyute.github.io/tags/php/"/>
    
      <category term="设计模式" scheme="//yeyute.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>秒杀活动的架构设计</title>
    <link href="//yeyute.github.io/2016/03/09/%E7%A7%92%E6%9D%80%E6%B4%BB%E5%8A%A8%E7%9A%84%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/"/>
    <id>//yeyute.github.io/2016/03/09/秒杀活动的架构设计/</id>
    <published>2016-03-09T09:04:18.000Z</published>
    <updated>2017-10-10T12:09:33.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="业务的基本说明"><a href="#业务的基本说明" class="headerlink" title="业务的基本说明"></a>业务的基本说明</h3><ol><li>运营评估最高的并发会达到  10W（根据推广的力度，以及以往的经验）</li><li>业务现有的服务器架构 反向代理 4台，前端机 8台， db 2台（主从），redis 2台（主从）以下是服务器架构图</li></ol><p><img src="https://yeyute.github.io/assets/msjgt.jpg" alt="服务器架构图"></p><a id="more"></a><h3 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h3><p>html 等静态文件上CDN ，这方面压力不大<br>后台程序动态接口，必须支持高并发，用户体验必须做好<br>后端程序优化点（欢迎大家补充）</p><ul><li>程序尽可能的减少加载的文件</li><li>程序减少不必要的网络请求</li><li>redis 队列来作 异步方式实现</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 后台进程消费队列 个人使用brpoplpush方法 取出数据并用存入另外队列作数据备份</span></div><div class="line">$block_expire_time = <span class="number">0</span>; <span class="comment"># 设置阻塞等待时间为永久</span></div><div class="line">$redis-&gt;brpoplpush($key, $backup_key, $block_expire_time);</div></pre></td></tr></table></figure><ul><li>redis 缓存</li><li>前端点击按钮请求后变灰，防止用户重复点击</li><li>静态文件上CDN </li><li>nginx的最大连接数设置为550，防止连接数过大时全部到php，导致php服务挂了</li><li>针对每个用户加并发锁（redis），防止高并发情况判断条件被绕过,程序执行完后解锁。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$lock_status = $redis-&gt;set($lock_key, <span class="number">1</span>, <span class="keyword">array</span>(<span class="string">"NX"</span>, <span class="string">"EX"</span>=&gt;$expire_time));</div></pre></td></tr></table></figure><h3 id="高并发下奖品超发问题"><a href="#高并发下奖品超发问题" class="headerlink" title="高并发下奖品超发问题"></a>高并发下奖品超发问题</h3><p>个人设计的方案：提前把每个奖品放入 redis队列，每个key一个奖品，队列的长度是奖品的数量，可以保证奖品不会超发放<br>另外，假设使用<br>悲观锁，在更新数据的时候加锁，其它的都为等待状态，不合适秒杀场景<br>乐观锁 基本是采用带版本号更新，版本号匹配才能更新，其它的回滚，虽然保证的数据的安全不超发放，但是在高并发场景下，DB只有两台的时候，超过mysql 进程堆积肯定会的， 超过最大连接数是怎么办，一系列的问题需要解决，所以该方案不合适</p><h3 id="程序压测结果分析服务器能抗的并发"><a href="#程序压测结果分析服务器能抗的并发" class="headerlink" title="程序压测结果分析服务器能抗的并发"></a>程序压测结果分析服务器能抗的并发</h3><p>在平均响应时间300ms内，单台qps 750 左右（保持300ms是公司压测试的规范指标）<br>10台机器（后面新增2台到 8+2）一秒钟能处理： 10 * 750/0.3 = 25000<br>但是系统在高并发的状态下，响应时间有可能从300ms 变成500ms，所以在做评估，需要预留一定的空间<br>那么问题来了，<br>保守的并发只有1.5W,与10w 差距大，需要在执行方案上解决，公司不可无限的申请web机器。<br>解决10W并发问题(资源有限的情况)方案<br>在代理层做处理，根据权重挡掉90%的量，返回800（自定义），前端判断是否为800，是则提示火爆用户重试（对应的方案设置友好一些）</p><h3 id="活动的序列图及说明"><a href="#活动的序列图及说明" class="headerlink" title="活动的序列图及说明"></a>活动的序列图及说明</h3><ol><li>接口程序不连接查询mysql数据库</li><li>奖品的数据存放redis队列，每个奖品一个key，队列长度是奖品的数量</li><li>用户成功领取红包（或抢购）时的代码流程（不包括业务限制与防刷），从队列获取奖品成功，再入队列（此队列后台消费入库），返回给用户领取成功。在用户体验上有所提升，但如果后台队列堆积太多，未能消费完成，用户查看的红包时是没有对应记录的，所以针对自己的需求作对应的优化。</li></ol><p><img src="https://yeyute.github.io/assets/xlt.jpg" alt="活动流程图"></p><h3 id="活动流程图（开爷画的）"><a href="#活动流程图（开爷画的）" class="headerlink" title="活动流程图（开爷画的）"></a>活动流程图（开爷画的）</h3><p><img src="https://yeyute.github.io/assets/lct.png" alt="活动流程图"></p>]]></content>
    
    <summary type="html">
    
      稳定版本的设计
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="架构设计" scheme="//yeyute.github.io/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>用脚步丈量家乡 - 汕尾</title>
    <link href="//yeyute.github.io/2016/02/22/%E7%94%A8%E8%84%9A%E6%AD%A5%E4%B8%88%E9%87%8F%E5%AE%B6%E4%B9%A1-%E6%B1%95%E5%B0%BE/"/>
    <id>//yeyute.github.io/2016/02/22/用脚步丈量家乡-汕尾/</id>
    <published>2016-02-22T10:00:11.000Z</published>
    <updated>2017-10-10T12:09:28.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="汕尾"><a href="#汕尾" class="headerlink" title="汕尾"></a>汕尾</h3><p>或许汕尾这个城市鲜为人知，一般情况下说汕尾，对方都会复读一次是“汕头”来确认，但汕尾确实是以后可以养老的好地方，空气质量好，生活节奏慢.</p><p>不过大家都为了理想而各奔东西，每年回家乡的次数也有限，借着春节的假期，各种聚会的疯狂过后，去认真的体会一下家乡的自然与空气，这种熟悉且又有了陌生的感觉，让人心平气静。</p><p>沿着汕尾海边街，一路顶着海风飞（man）奔（pao）起来，想知道在海边跑步是什么感受的话，我来告诉你，就一个字，爽。</p><h3 id="下面贴个跑步的小地图"><a href="#下面贴个跑步的小地图" class="headerlink" title="下面贴个跑步的小地图"></a>下面贴个跑步的小地图</h3><p><img src="https://yeyute.github.io/assets/pbdt.jpg" alt=""></p><a id="more"></a><h3 id="海边街"><a href="#海边街" class="headerlink" title="海边街"></a>海边街</h3><p>相比广州珠江边，这里更具有清新的气息，看着这条路上运动的人越来越多，个人感觉是汕尾人民对自我生活的一种提升吧。</p><p><img src="https://yeyute.github.io/assets/hbj.jpg" alt=""></p><p>跑步有一片蓝天，像玩家有着好的游戏体验一样，跑步真是一项最简单的运动</p><p><img src="https://yeyute.github.io/assets/lt.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      跑步
    
    </summary>
    
      <category term="Life" scheme="//yeyute.github.io/categories/Life/"/>
    
    
      <category term="生活" scheme="//yeyute.github.io/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>Mysql 查询今天、昨天、最近7天、最近30天的优化</title>
    <link href="//yeyute.github.io/2016/01/10/Mysql%20%E6%9F%A5%E8%AF%A2%E4%BB%8A%E5%A4%A9%E3%80%81%E6%98%A8%E5%A4%A9%E3%80%81%E6%9C%80%E8%BF%917%E5%A4%A9%E3%80%81%E6%9C%80%E8%BF%9130%E5%A4%A9%E7%9A%84%E4%BC%98%E5%8C%96/"/>
    <id>//yeyute.github.io/2016/01/10/Mysql 查询今天、昨天、最近7天、最近30天的优化/</id>
    <published>2016-01-10T15:48:47.000Z</published>
    <updated>2017-10-10T12:10:59.000Z</updated>
    
    <content type="html"><![CDATA[<p>表结构<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`student`</span> (</div><div class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</div><div class="line">  <span class="string">`createtime`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</div><div class="line">  <span class="string">`price`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</div><div class="line">  <span class="keyword">KEY</span> <span class="string">`createtime`</span> (<span class="string">`createtime`</span>) <span class="keyword">USING</span> BTREE</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>  <span class="keyword">CHARSET</span>=utf8;</div></pre></td></tr></table></figure></p><a id="more"></a><p>查询分析 今天、昨天、最近7天、最近30天的收入总数<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">sum</span>(price) <span class="keyword">as</span> <span class="built_in">number</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">to_days</span>(<span class="keyword">date_format</span>(FROM_UNIXTIME(<span class="string">`createtime`</span>),<span class="string">'%Y-%m-%d'</span>))=<span class="keyword">to_days</span>(<span class="keyword">now</span>()) </div><div class="line"><span class="keyword">UNION</span> ALL </div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">sum</span>(price) <span class="keyword">as</span> <span class="built_in">number</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> <span class="keyword">TO_DAYS</span>( <span class="keyword">NOW</span>( ) ) - <span class="keyword">TO_DAYS</span>( <span class="keyword">date_format</span>(FROM_UNIXTIME(<span class="string">`createtime`</span>),<span class="string">'%Y-%m-%d'</span>)) &lt;= <span class="number">1</span> &amp;&amp; <span class="keyword">to_days</span>(<span class="keyword">date_format</span>(FROM_UNIXTIME(<span class="string">`createtime`</span>),<span class="string">'%Y-%m-%d'</span>))!=<span class="keyword">to_days</span>(<span class="keyword">now</span>()) </div><div class="line"><span class="keyword">UNION</span> ALL </div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">sum</span>(price) <span class="keyword">as</span> <span class="built_in">number</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">DATE_SUB</span>(<span class="keyword">CURDATE</span>(), <span class="built_in">INTERVAL</span> <span class="number">7</span> <span class="keyword">DAY</span>) &lt;= <span class="built_in">date</span>(<span class="keyword">date_format</span>(FROM_UNIXTIME(<span class="string">`createtime`</span>),<span class="string">'%Y-%m-%d'</span>)) </div><div class="line"><span class="keyword">UNION</span> ALL </div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">sum</span>(price) <span class="keyword">as</span> <span class="built_in">number</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">where</span> <span class="keyword">DATE_SUB</span>(<span class="keyword">CURDATE</span>(), <span class="built_in">INTERVAL</span> <span class="number">30</span> <span class="keyword">DAY</span>) &lt;= <span class="built_in">date</span>(<span class="keyword">date_format</span>(FROM_UNIXTIME(<span class="string">`createtime`</span>),<span class="string">'%Y-%m-%d'</span>))</div></pre></td></tr></table></figure></p><p>加了索引的情况下用不到索引</p><p>这里是图片</p><p>使用php程序时使用<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">sum</span>(price) <span class="keyword">as</span> <span class="built_in">number</span> <span class="keyword">from</span> student <span class="keyword">where</span> <span class="keyword">to_days</span>(<span class="keyword">date_format</span>(FROM_UNIXTIME(<span class="string">`createtime`</span>),<span class="string">'%Y-%m-%d'</span>))=<span class="keyword">to_days</span>(<span class="keyword">now</span>()) </div><div class="line"><span class="keyword">UNION</span> ALL </div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">sum</span>(price) <span class="keyword">as</span> <span class="built_in">number</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">TO_DAYS</span>( <span class="keyword">NOW</span>( ) ) - <span class="keyword">TO_DAYS</span>( <span class="keyword">date_format</span>(FROM_UNIXTIME(<span class="string">`createtime`</span>),<span class="string">'%Y-%m-%d'</span>)) &lt;= <span class="number">1</span> &amp;&amp; <span class="keyword">to_days</span>(<span class="keyword">date_format</span>(FROM_UNIXTIME(<span class="string">`createtime`</span>),<span class="string">'%Y-%m-%d'</span>))!=<span class="keyword">to_days</span>(<span class="keyword">now</span>()) </div><div class="line"><span class="keyword">UNION</span> ALL </div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">sum</span>(price) <span class="keyword">as</span> <span class="built_in">number</span> <span class="keyword">FROM</span> student <span class="keyword">where</span> <span class="keyword">DATE_SUB</span>(<span class="keyword">CURDATE</span>(), <span class="built_in">INTERVAL</span> <span class="number">7</span> <span class="keyword">DAY</span>) &lt;= <span class="built_in">date</span>(<span class="keyword">date_format</span>(FROM_UNIXTIME(<span class="string">`createtime`</span>),<span class="string">'%Y-%m-%d'</span>)) </div><div class="line"><span class="keyword">UNION</span> ALL </div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">sum</span>(price) <span class="keyword">as</span> <span class="built_in">number</span> <span class="keyword">FROM</span> student <span class="keyword">where</span> <span class="keyword">DATE_SUB</span>(<span class="keyword">CURDATE</span>(), <span class="built_in">INTERVAL</span> <span class="number">30</span> <span class="keyword">DAY</span>) &lt;= <span class="built_in">date</span>(<span class="keyword">date_format</span>(FROM_UNIXTIME(<span class="string">`createtime`</span>),<span class="string">'%Y-%m-%d'</span>))</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">sum</span>(price) <span class="keyword">as</span> <span class="built_in">number</span> <span class="keyword">from</span> student <span class="keyword">where</span> createtime&gt;=<span class="string">'1489161600'</span></div><div class="line"><span class="keyword">UNION</span> ALL </div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">sum</span>(price) <span class="keyword">as</span> <span class="built_in">number</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> createtime&gt;=<span class="string">'1489075200'</span> &amp;&amp; createtime&lt;=<span class="string">'1489161600'</span></div><div class="line"><span class="keyword">UNION</span> ALL </div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">sum</span>(price) <span class="keyword">as</span> <span class="built_in">number</span> <span class="keyword">FROM</span> student <span class="keyword">where</span> createtime&gt;=<span class="string">'1488556800'</span> &amp;&amp; createtime&lt;=<span class="string">'1489247999'</span></div><div class="line"><span class="keyword">UNION</span> ALL </div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">sum</span>(price) <span class="keyword">as</span> <span class="built_in">number</span> <span class="keyword">FROM</span> student <span class="keyword">where</span> createtime&gt;=<span class="string">'1486483200'</span> &amp;&amp; createtime&lt;=<span class="string">'1489247999'</span></div></pre></td></tr></table></figure></p><h3 id="优化方法"><a href="#优化方法" class="headerlink" title="优化方法"></a>优化方法</h3><p>后续补</p>]]></content>
    
    <summary type="html">
    
      mysql
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="mysql" scheme="//yeyute.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>mysql 数据阻塞，进程数满，服务挂了</title>
    <link href="//yeyute.github.io/2016/01/08/mysql-%E6%95%B0%E6%8D%AE%E9%98%BB%E5%A1%9E%EF%BC%8C%E8%BF%9B%E7%A8%8B%E6%95%B0%E6%BB%A1/"/>
    <id>//yeyute.github.io/2016/01/08/mysql-数据阻塞，进程数满/</id>
    <published>2016-01-08T14:35:40.000Z</published>
    <updated>2017-10-10T12:11:19.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="出现慢查询且并发高的情景下"><a href="#出现慢查询且并发高的情景下" class="headerlink" title="出现慢查询且并发高的情景下"></a>出现慢查询且并发高的情景下</h3><p>一个中型的活动，当时做的时候不够细心，出现了数据库崩溃<br>进入数据库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">show</span> <span class="keyword">full</span> <span class="keyword">processlist</span></div></pre></td></tr></table></figure><a id="more"></a><p>state 显示 sending data ，意思是从物理磁盘获取数据的进程<br>当时数据更新sql语句写得不好，结果集达到了3W多，update 的数据只update一条，并发一过来，导致结果集全部锁着，释放不了<br>导致大量请求阻塞在，连接数过多，mysql 服务器挂了，导致业务全面奔溃，准备写故障报告</p><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><ol><li>从慢日志当中查询到对应的sql语句，进行优化后发布代码</li><li>服务重启，因为不影响活动后续的进行</li></ol><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol><li>针对任何活动不可大意，对每条sql亲自过一遍，避免低级错误重复出现 </li></ol><h3 id="Freeing-items-的情况-网上了解到还有这种状态"><a href="#Freeing-items-的情况-网上了解到还有这种状态" class="headerlink" title="Freeing items 的情况(网上了解到还有这种状态)"></a>Freeing items 的情况(网上了解到还有这种状态)</h3><p>如果影响的结果集过大，说明索引项不够优化，Freeing items 当磁盘的 i/o 压力过大，也可能出现 Freeing items<br>执行时间较长的情况 Sorting for … 跟sending data 情况一样结果集过大，排序条件没有优化，需要在内存里面优化，甚至需要创建临时结构排序 Copy to tmp table 索引及现有结构无法涵盖查询条件，才会建立一个临时表来满足查询要求，产生巨大的恐怖的i/o压力。<br>Waiting for net, reading from net, writing to net 案例:因外挂程序，内网数据库大量读取，内网使用的百兆交换迅速爆满，导致大量连接阻塞在waiting for net，数据库连接过多崩溃</p>]]></content>
    
    <summary type="html">
    
      mysql 数据阻塞，进程数满
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="mysql" scheme="//yeyute.github.io/tags/mysql/"/>
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Mysql 字段类型</title>
    <link href="//yeyute.github.io/2016/01/03/Mysql-%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B/"/>
    <id>//yeyute.github.io/2016/01/03/Mysql-字段类型/</id>
    <published>2016-01-03T12:16:38.000Z</published>
    <updated>2017-10-10T12:11:13.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="CHAR"><a href="#CHAR" class="headerlink" title="CHAR"></a>CHAR</h3><ol><li>类型是定长 删除末尾的空格，不会删除前面的空格</li><li>适合存储很短的字符串，或者所有值都接近同一个长度。例如: 适合存储MD5的密码串</li><li>定长的CHAR不容易产生碎片</li><li>对于非常短的列，CHAR比VARCHAR在存储更有效率。例如: CHAR(1) 来存储只有Y 和 N 的值，VARCHAR需要2个字节，CHAR只需要一个字节</li></ol><h3 id="VARCHAR"><a href="#VARCHAR" class="headerlink" title="VARCHAR"></a>VARCHAR</h3><ol><li>可变长的字符串 比定长类型CHAR更节省空间</li><li>需要使用额外的1 个或2个字符串来记录字符串的长度，小于255 只使用一个字节，大于使用2个</li><li><a id="more"></a></li></ol><h3 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h3><ol><li>TINYINT - 8 , SMALLINT - 16, MEDIUMINT - 24, INT - 32, BIGINT - 64 位的存储空间 -2的N-1次方到 2的N-1次方-1<br>2:可选 UNSIGNED属性 ，表示不允许负值 ，大致可以使正数上限提高一倍</li></ol><h3 id="实数类型"><a href="#实数类型" class="headerlink" title="实数类型"></a>实数类型</h3><ol><li>实数是带有小数部分的数字，也可以使用BECIMAL 格式 create table ta (a float,b decimal(6,5));6为小数点左边的位数，5为小数点右边的位数，当插入的小数点右边的位数大于5 后面的将被截掉，当插入小数点左边的位数大于6时，将取 999999</li><li>DECIMAL 是存储精确的小数，应该尽量只在小数进行精确计算时才使用，但数据量较大时，可以考虑使用BIGINT代替，要精确到万分之一的数据，可以把所有金额乘以一百万再存储进BIGINT里。</li><li>FLOAT 占用4个字节 </li><li>DOUBLE占用8个字节 相比FLOAT有更高的精度与更大的范围</li></ol><h3 id="DATETIME-和-TIMESAMP"><a href="#DATETIME-和-TIMESAMP" class="headerlink" title="DATETIME 和 TIMESAMP"></a>DATETIME 和 TIMESAMP</h3><ol><li>都可以存储相同的数据，时间和日期</li><li>TIMESAMP 只使用DATETIME一半的存储空间（4个字节与8个字节），并且根据时区变化，具有特殊的自动更新能力，但TIMESTAMP允许的时间范围小得多</li><li>DATETIME 范围 1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</li><li>TIMESAMP 范围 1970-01-01 08:00:01到2038-01-19 11:14:07</li><li>TIMESTAMP类型在默认情况下，insert、update 数据时，TIMESTAMP列会自动以当前时间（CURRENT_TIMESTAMP）填充/更新</li><li>使用INT存时间戳在业务上不方便处理的情况下，不建议使用</li></ol><p>BLOB与TEXT 类型</p><ol><li>BLOB 和TEXT类型都是为了存储很大的数据而设计的，分别采用二进制和字符方式存储</li><li>二进制类型有TINYBLOB,SMALLBLOB,BLOB,MEDIUMBLOB,LONGBLOB，字符类型是 TINYTEXT,SMALLTEXT,TEXT,MEDIUMTEXT,LONGTEXT，ENUM枚举与FIELD指定排序顺序</li></ol><h3 id="选择优化的数据类型"><a href="#选择优化的数据类型" class="headerlink" title="选择优化的数据类型"></a>选择优化的数据类型</h3><ol><li>更小的数据类型通常更好,它们占用更小的磁盘，内存和CPU缓存，处理时需要的CPU周期更少</li><li>简单就好,整型比字符操作代价更低，因为字符集和校对规则使字符比较整型比较更复杂</li><li>尽量避免NULL<ol><li>查询中包含可为NULL对MYSQL来说更难优化，因为可为NULL的列使得索引、索引统计和值 比较都较为复杂</li><li>可为NULL 的列使使用更多的存储空间，MYSQL里也需要特殊处理，当可为NULL被索引时,每个索引记录需要额外的字节</li><li>调优时，把可为NULL调为NOT NULL带来的性能提升比较小，除非确定此问题导致问题</li></ol></li><li>使用VARCHAR(5) 与 VARCHAR(200)存储的区别<ol><li>存储HELLO的空间开销是一样的，但是更长的列会消耗更多的内存，因为MYSQL通常会分配固定大小内存块来保存内部值</li><li>尤其是使用内存临时表时表进行排序或操作时会更糟糕</li></ol></li></ol>]]></content>
    
    <summary type="html">
    
      字段类型,mysql
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="mysql" scheme="//yeyute.github.io/tags/mysql/"/>
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Mysql 覆盖索引</title>
    <link href="//yeyute.github.io/2016/01/02/Mysql-%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95/"/>
    <id>//yeyute.github.io/2016/01/02/Mysql-覆盖索引/</id>
    <published>2016-01-02T02:53:13.000Z</published>
    <updated>2017-10-10T12:11:29.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ol><li>覆盖索引能够极大地提高性能。 考虑一下如果查询只需要扫描索引而无须回表，会带来多少好处 <ol><li>索引的条目通常远小于数据行大小，所以如果只需要读取索引，那极大地减少数据访问量，所以更内容全部放在内存中</li><li>索引是按照列值顺序存储的（至少单个页内是这样的）</li><li>一些存储引擎如MyISAM 的内存只缓存索引。</li><li>由于innodb 的聚簇索引，覆盖索引 对Innodb表特别有用。 Innodb的二级索引在叶子节点中保存了行的主键值，所以如果二级主键能够覆盖查询，则可以避免对主键索引的二次查询</li></ol></li><li>mysql 只能用b-tree索引来做覆盖索引</li><li>当发起一个被索引覆盖的查询时，在 EXPLAIN 的extra列可以看到 “Using index”的信息</li></ol><a id="more"></a><p>例子</p><pre><code>explain select * from prodcuts where actor = &quot;yeyute&quot; and title like &apos; %aplollo%&apos;;</code></pre><ol><li>没有任务索引能够覆盖这个查询，因为查询从表中选择了所有的列， 不过 where 条件中的表是有索引可以覆盖的</li><li>mysql 不能在索引中执行like 操作 。 mysql5.5以为更早版本，只允许在索引中做简单操作（&gt; 和 &gt;= 和 !=  ）,这种情况，mysql 只能提取数据行的值而不是索引值来做比较</li></ol><h3 id="使用索引扫描来做排序"><a href="#使用索引扫描来做排序" class="headerlink" title="使用索引扫描来做排序"></a>使用索引扫描来做排序</h3><ul><li>explain type列的值为“index”</li><li>如果索引不能覆盖查询所需的全部列，就得扫描查询所需的全部列</li><li>mysql 可以使用同一个索引既满足排序，又用于查找行</li><li>关联多表时，只有当order by 子句引用的字段全部为第一个表时，才能使用索引做排序</li><li>建立（sex,country），查询时不限制性别，可以在查询条件新增 sex in(‘m’,’f’) and country=’’ 来使用索引</li></ul>]]></content>
    
    <summary type="html">
    
      覆盖索引,mysql
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="mysql" scheme="//yeyute.github.io/tags/mysql/"/>
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Mysql 聚簇索引(Clustered Index)</title>
    <link href="//yeyute.github.io/2016/01/01/Mysql-%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95/"/>
    <id>//yeyute.github.io/2016/01/01/Mysql-聚簇索引/</id>
    <published>2016-01-01T06:18:32.000Z</published>
    <updated>2017-10-10T12:11:23.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ol><li>每个表只能有一个聚簇索引，因为一个表中的记录只能以一种物理顺序存放，但是，一个表可以有不止一个非聚簇索引。例:你翻到新华字典的汉字“爬”那一页就是P开头的部分，这就是物理存储顺序（聚簇索引）；而不用你到目录，找到汉字“爬”所在的页码，然后根据页码找到这个字（非聚簇索引）</li><li>如果需要该索引,只要将索引指定为主键(primary key)就可以，根据主键创建聚簇索引</li><li>如果正在使用Innodb 表并且没有什么数据需要聚集，那么可以定义一个代理键作为主键，这种主键的数据应该和应用无关，最简单的方法是使用AUTO_INCREMENT 自增列。这样可以保证数据行是按顺序写入，对于根据主键做关联操作的性能也会更好。 </li><li>顺序的主键会造成什么坏的结果？ 在高并发插入可能导致间隙锁竞争，可以考虑重新设计表，或者更改innodb_autoinc_lock_mode参数（innodb在语句1的实际插入操作执行前就预分配给该语句三个自增值，当有一个新的insert语句2要执行时，读取的AUTO_INCREMENT=4，这样虽然语句1可能还没有执行完，语句2就可直接执行无需等待语句2。）</li></ol><a id="more"></a><h3 id="什么时候用到聚簇索引"><a href="#什么时候用到聚簇索引" class="headerlink" title="什么时候用到聚簇索引"></a>什么时候用到聚簇索引</h3><p>以下将id设置为主键时，mysql 会根据主键创建聚簇索引,例：如果没设置主键，自增，where id=’1000’，是扫描全表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test_user`</span> (</div><div class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</div><div class="line"><span class="string">`user_name`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</div><div class="line"><span class="string">`password`</span> <span class="built_in">CHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</div><div class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>  <span class="keyword">CHARSET</span>=utf8;</div></pre></td></tr></table></figure></p><p>设置id为主键，自增，以下是对应的分析数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">select</span> * <span class="keyword">from</span> test_user <span class="keyword">where</span> <span class="keyword">id</span>=<span class="string">'16000000'</span> ;</div></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left">字段</th><th style="text-align:left">值</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">select_type</td><td style="text-align:left">simple</td><td style="text-align:left">简单的 select 查询,不使用 union 及子查询</td></tr><tr><td style="text-align:left">table</td><td style="text-align:left">test_user</td><td style="text-align:left">表名</td></tr><tr><td style="text-align:left">partitions</td><td style="text-align:left">null</td><td style="text-align:left">列代表给定表所使用的分区</td></tr><tr><td style="text-align:left">type</td><td style="text-align:left">const</td><td style="text-align:left">是说明只有一条匹配值，</td></tr><tr><td style="text-align:left">possible_keys</td><td style="text-align:left">PRIMARY</td><td style="text-align:left">指出 MySQL 能在该表中使用哪些索引有助于 查询。如果为空,说明没有可用的索引</td></tr><tr><td style="text-align:left">key</td><td style="text-align:left">PRIMARY</td><td style="text-align:left">MySQL 实际从 possible_key 选择使用的索引</td></tr><tr><td style="text-align:left">key_len</td><td style="text-align:left">4</td><td style="text-align:left">使用的索引的长度。在不损失精确性的情况 下,长度越短越好</td></tr><tr><td style="text-align:left">ref</td><td style="text-align:left">const</td><td style="text-align:left">where 条件筛选后表上至多有一条元组匹配时</td></tr><tr><td style="text-align:left">rows</td><td style="text-align:left">1</td><td style="text-align:left">MYSQL 认为必须检查的用来返回请求数据的行数</td></tr><tr><td style="text-align:left">filtered</td><td style="text-align:left">100</td><td style="text-align:left">列给出了一个百分比的值，这个百分比值和rows列的值一起使用，可以估计出那些将要和QEP中的前一个表进行连接的行的数目。前一个表就是指id列的值比当前表的id小的表</td></tr></tbody></table><h3 id="主键设置为那个字段合适"><a href="#主键设置为那个字段合适" class="headerlink" title="主键设置为那个字段合适"></a>主键设置为那个字段合适</h3><p>情况分析</p><ol><li>选择聚簇索引应基于where子句和连接操作的类型。</li><li>在聚簇索引中不要包含经常修改的列，因为值修改后，数据行必须移动到新的位置。</li><li>大多数表都应该有聚簇索引或使用分区来降低对表尾页的竞争，在一个高事务的环境中，对最后一页的封锁严重影响系统的吞吐量</li><li>在聚簇索引下，数据在物理上按顺序排在数据页上，重复值也排在一起，因而在那些包含范围检查(between、&lt;、&lt;=、&amp; gt;、&gt;=)或使用group by或order by的查询时，一旦找到具有范围中第一个键值的行，具有后续索引值的行保证物理上毗连在一起而不必进一步搜索，避免了大范围扫描，可以大大提高查询速度。</li><li>在一个频繁发生插入操作的表上建立聚簇索引时，不要建在具有单调上升值的列(如IDENTITY)上，否则会经常引起封锁冲突。</li></ol><p>用户名字段，可以设置为主键，但是不推荐<br>1.用户名是比较规则字母数字序列，这可能导致性能上有所差别<br>2.假如以用户名作为主键并与其他表关联，当删除用户时，再创建一个同名的用户，可能导致这些关联紊乱。而绝对唯一的ID则不会。<br>3.有的系统可能会允许修改用户名，如果以用户名为主键，将带来很多麻烦。而如果以ID为主键进行关联，则没有此问题。</p><h3 id="聚簇索引中的记录是如何存放"><a href="#聚簇索引中的记录是如何存放" class="headerlink" title="聚簇索引中的记录是如何存放"></a>聚簇索引中的记录是如何存放</h3><ol><li>节点页只包含了索引列，叶子页包含了行的全部数据，就是既存储索引值,又在叶子中存储行的数据</li><li>Innodb是通过主键聚集数据，如果没有主键，Innodb会选择一个唯一的非空索引代替。如果没有这样的索引，会隐式定义一个主键来作为聚簇索引。</li><li>聚簇索引的每一个叶子节点都包含了主键值、事务ID、用于事务和MVCC的回滚指针以及所有的剩余列<br><img src="https://yeyute.github.io/assets/jcsy.png" alt=""></li></ol><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li>可以把相关的数据保存在一起。 例如电子邮件，可以根据用户ID来聚集数据，这样只需要从磁盘读取少数的数据页就能获取某个用户的全部邮件。如果没有使用聚簇索引，则每封邮件都可能导致一次磁盘的I/O.</li><li>数据访问更快。将索引和数据保存在同一个B-Tree中，因此从聚簇索引中获取数据通常比非聚簇索引查找更快</li><li>使用覆盖索引扫描的查询可以直接使用页节点中的主键值</li></ol><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol><li>聚簇数据最大限度地提高了I/O密集型应用的性能，但如果数据全部都放在内存中，则访问的顺序就没那么重要了，聚会簇索引也就没什么优势</li><li>更新索引列代价很大，因为innodb 强制将每个被更新的行移动到新的位置</li><li>插入的速度严重依赖于插入顺充，按照主键的顺序插入是加载数据到INNODB表中速度最快的方式，如果不是，那么加载完成后最好 使用optimize table命令重新排序</li><li>对于插入新行，或主键更新，导致需要移动行的时候，可能面临“页分裂”问题。 当行的主键值要求必须将这一行插入到某个已满的页中时，存储引擎会将该页分裂成两个页面来容纳该行，会导致表占用更大的磁盘空间</li><li>可能会导致全表扫描变慢，尤其是行比较稀疏 或者 页分裂 存储不连续的时候</li></ol>]]></content>
    
    <summary type="html">
    
      聚簇索引,mysql
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="mysql" scheme="//yeyute.github.io/tags/mysql/"/>
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>http 请求报文详解</title>
    <link href="//yeyute.github.io/2015/09/03/http-%E8%AF%B7%E6%B1%82%E4%BF%A1%E6%81%AF%E8%AF%A6%E8%A7%A3/"/>
    <id>//yeyute.github.io/2015/09/03/http-请求信息详解/</id>
    <published>2015-09-02T16:51:24.000Z</published>
    <updated>2017-10-10T12:10:40.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="两类报文"><a href="#两类报文" class="headerlink" title="两类报文"></a>两类报文</h3><ol><li>请求报文</li><li>响应报文</li></ol><a id="more"></a><h3 id="报文分三部分"><a href="#报文分三部分" class="headerlink" title="报文分三部分"></a>报文分三部分</h3><h4 id="对报文进行描述的起始行（start-line）"><a href="#对报文进行描述的起始行（start-line）" class="headerlink" title="对报文进行描述的起始行（start line）"></a>对报文进行描述的起始行（start line）</h4><p>请求报文 GET /php.info HTTP/1.1</p><table><thead><tr><th style="text-align:left">报文内容</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">GET</td><td style="text-align:left">请求的方法</td></tr><tr><td style="text-align:left">/php.info</td><td style="text-align:left">请求的地址</td></tr><tr><td style="text-align:left">HTTP/1.1</td><td style="text-align:left">请求版本</td></tr></tbody></table><p>响应报文 HTTP/1.1 200 OK</p><table><thead><tr><th style="text-align:left">报文内容</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">HTTP/1.1</td><td style="text-align:left">响应版本</td></tr><tr><td style="text-align:left">200 OK</td><td style="text-align:left">响应的状态码 内容</td></tr></tbody></table><h4 id="包含属性的首部（header）块"><a href="#包含属性的首部（header）块" class="headerlink" title="包含属性的首部（header）块"></a>包含属性的首部（header）块</h4><p><strong>请求报文</strong></p><table><thead><tr><th style="text-align:left">报文内容</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">accept(接收)</td><td style="text-align:left">指定客户端能够接收的内容类型 text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,<em>/</em>;q=0.8</td></tr><tr><td style="text-align:left">Accept-Encoding</td><td style="text-align:left">gzip(数据格式 ), deflate(默认且目前仅使用deflate算法压缩data部分，此法用于压缩传输), sdch(即通过字典压缩算法对各个页面中相同的内容进行压缩，减少相同的内容的传输。如：一个网站中一般都是共同的头部和尾部，甚至一些侧边栏也是共同的。之前的方式每个页面打开的时候这些共同的信息都要重新加载，但使用SDCH压缩方式的话，那些共同的内容只用传输一次就可以了)</td></tr><tr><td style="text-align:left">Accept-Language</td><td style="text-align:left">zh-cn ,zh; q=0.8   接收语言Cache-Control:</td></tr><tr><td style="text-align:left">Cache-Control</td><td style="text-align:left">值为private、no-cache、must-revalidate，那么打开新窗口访问时都会重新访问服务器。 而如果指定了max-age值，那么在此值内的时间里就不会重新访问服务器，例如： Cache-control: max-age=5(表示当访问此网页后的5秒 内再次访问不会去服务器)</td></tr><tr><td style="text-align:left">connection</td><td style="text-align:left">keep-alive 默认是长连接 其优点是、在资源包含多个元素是(比如web页面中的图片)将减少下载时间，当Connection为Keep-Alive时、表示在Keep-Alive时间内不会断开连接。而非KeepAlive模式时、请求之后都将会断开</td></tr><tr><td style="text-align:left">host</td><td style="text-align:left">域名或ip</td></tr><tr><td style="text-align:left">If-Modified-Since</td><td style="text-align:left">使用If-Modified-Since标签，把上次服务器告诉它的文件最后修改时间返回到服务器端了，文件没有改动过，所以服务器返回的HTTP状态码是304，没有发送页面的内容</td></tr><tr><td style="text-align:left">Upgrade-Insecure-Requests</td><td style="text-align:left">值为1 则是告诉服务器，自己支持这种操作，也就是我能读懂你服务器发过来的上面这条信息，并且在以后发请求的时候不用http而用https</td></tr><tr><td style="text-align:left">User-Agent:</td><td style="text-align:left">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36 表示请求的客户端浏览器详细信息</td></tr></tbody></table><p><strong>响应报文</strong></p><table><thead><tr><th style="text-align:left">报文内容</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">Connection</td><td style="text-align:left">keep-alive* 默认是长连接 其优点是、在资源包含多个元素是(比如web页面中的图片)将减少下载时间，当Connection为Keep-Alive时、表示在Keep-Alive时间内不会断开连接。而非KeepAlive模式时、请求之后都将会断开</td></tr><tr><td style="text-align:left">Content-Encoding</td><td style="text-align:left">响应正文使用的数据压缩格式</td></tr><tr><td style="text-align:left">Content-language</td><td style="text-align:left">响应正文使用的语言</td></tr><tr><td style="text-align:left">Content-Type</td><td style="text-align:left">响应正文的类型（是图片还是二进制字符串）</td></tr><tr><td style="text-align:left">Date</td><td style="text-align:left">服务器响应的时间</td></tr><tr><td style="text-align:left">Last-Modified</td><td style="text-align:left">Sun, 26 Jun 2016 04:14:32 GMT* 最后修改的时间</td></tr><tr><td style="text-align:left">Server</td><td style="text-align:left">nginx/1.6.2* http服务器的类型/版本 这个有时会造成有人专门利用特定版本网页服务器漏洞进行攻击，nginx可以在配置文件中增加或修改server_tokens off 来去除版本号</td></tr><tr><td style="text-align:left">Link</td><td style="text-align:left">Accept-Encoding 响应头，明确告知缓存服务器按照 Accept-Encoding 字段的内容，分别缓存不同的版本</td></tr><tr><td style="text-align:left">Set-Cookie</td><td style="text-align:left">AST_LANG=zh; expires=Mon, 26-Jun-2015 14:37:17 GMT; Max-Age=31536000; path=/; domain=.php.net*</td></tr><tr><td style="text-align:left">Transfer-Encoding</td><td style="text-align:left">chunked 分块编码 表示输出的内容长度不能确定，报文中的实体需要改为用一系列分块来传输，每个分块包含十六进制的长度值和数据，长度值独占一行，长度不包括它结尾的 CRLF(\r\n)，也不包括分块数据结尾的 CRLF。最后一个分块长度值必须为 0，对应的分块数据没有内容，表示实体结束</td></tr><tr><td style="text-align:left">Vary</td><td style="text-align:left">参考此文章 <a href="https://imququ.com/post/vary-header-in-http.html" target="_blank" rel="external">https://imququ.com/post/vary-header-in-http.html</a></td></tr><tr><td style="text-align:left">X-Frame-Options</td><td style="text-align:left">DENY：浏览器拒绝当前页面加载任何Frame页面，SAMEORIGIN：frame页面的地址只能为同源域名下的页面，ALLOW-FROM：origin为允许frame加载的页面地址</td></tr><tr><td style="text-align:left">X-Powered-By</td><td style="text-align:left">PHP/5.2.1，可在php.ini中增加或修改 expose_php = Off关闭,使用了ThinkPHP会输出 ThinkPHP 2.0，可修改相关类文件关闭</td></tr><tr><td style="text-align:left">Cache-Control</td><td style="text-align:left">max-age=600 表示当访问此网页后的600秒内 告诉浏览器再次访问不去访问服务器</td></tr><tr><td style="text-align:left">Expires</td><td style="text-align:left">HTTP控制缓存的基本手段，这个属性告诉缓存器：相关副本在多长时间内是新鲜的。过了这个时间，缓存器就会向源服务器发送请求，检查文档是否被修 改。几乎所有的缓存服务器</td></tr><tr><td style="text-align:left">Content-Length</td><td style="text-align:left">实体长度 通常如果 Content-Length 比实际长度短，会造成内容被截断;如果比实体内容长，会造成 pending</td></tr></tbody></table><h4 id="可选的、包含数据的主体（body）"><a href="#可选的、包含数据的主体（body）" class="headerlink" title="可选的、包含数据的主体（body）"></a>可选的、包含数据的主体（body）</h4><p>就是http 要传输的内容</p>]]></content>
    
    <summary type="html">
    
      http 报文
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="http" scheme="//yeyute.github.io/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>http 代理</title>
    <link href="//yeyute.github.io/2015/07/03/http-%E4%BB%A3%E7%90%86%E8%AF%A6%E8%A7%A3/"/>
    <id>//yeyute.github.io/2015/07/03/http-代理详解/</id>
    <published>2015-07-02T17:16:49.000Z</published>
    <updated>2017-10-10T12:10:28.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="web-代理-proxy"><a href="#web-代理-proxy" class="headerlink" title="web 代理(proxy)"></a>web 代理(proxy)</h3><p>代理位于客户端和服务器之间，扮演“中间人”的角色，对web客户端来说是扮演服务器的角色，对服务器来说是扮演客户端的角色</p><h3 id="代理与网关的对比"><a href="#代理与网关的对比" class="headerlink" title="代理与网关的对比"></a>代理与网关的对比</h3><p>代理连接的是两个或多个使用相同协议的应用程序<br>网关扮演的是“协议转换器”的角色，即使客户端和服务器使用的是不同的协议，客户端也可以通过网关完成与服务器之间的事务处理，例：浏览器&lt;-&gt;web/e-mail 网关(pop) &lt;-&gt; e-mail服务器 ，网关将不同的协议连接起来</p><a id="more"></a><h3 id="为什么使用代理，运用的场景"><a href="#为什么使用代理，运用的场景" class="headerlink" title="为什么使用代理，运用的场景"></a>为什么使用代理，运用的场景</h3><ol><li>代理服务器可以看到并接触到所有流过的http流量，所以代理可以监视流量并对其进行修改<br>应用的场景</li><li>集中式访问控制代理(对禁止的站点强行禁止访问)</li><li>集中式文档访问控制代理</li><li>安全防火墙(提高安全性，以便对流量进行详细的检查)</li><li>web 缓存</li><li>反向代理，以制作于分布式网络</li><li>内容路由器（根据网络流量状态以及内容类型将请求导向特定的服务器）</li><li>转码器 例：可以在传输gif图片时，将其转换成jpeg图片，减少尺寸，也可以对图片进行压缩，同样可以对文本压缩</li><li>匿名者（主动从http报文中删除身份特性，例ip，from头部，referer(请求报头，告知服务器用户的来源页面)首部，cookie,uri的会话id）</li></ol><h3 id="反向代理与正向代理"><a href="#反向代理与正向代理" class="headerlink" title="反向代理与正向代理"></a>反向代理与正向代理</h3><p>反射代理 - 保护和隐藏原始资源服务器</p><p>情景- 用户 c -&gt;代理 a -&gt;机器 b</p><ol><li>正向代理 - 主体是 c，a是c的代理</li><li>反向代理 - 主体是 c，a是b的代理</li></ol><h3 id="代理服务器的部署的几种方式"><a href="#代理服务器的部署的几种方式" class="headerlink" title="代理服务器的部署的几种方式"></a>代理服务器的部署的几种方式</h3><ol><li>出口代理  控制本地网络与大型因特网之间的流量，公司部分网站控制访问等</li><li>访问（入口）代理  用于处理客户的聚合请求，。ISP使用缓存代理来存储常用文档的副本来提高用户的下载速度</li><li>反向代理</li><li>网络交换代理 将具有足够能力的代理放在网络之间的因特网对等交换点上，通过缓存来减轻因特网节点的拥塞，并对流量进行监视</li></ol><h3 id="代理如何获取流量的"><a href="#代理如何获取流量的" class="headerlink" title="代理如何获取流量的"></a>代理如何获取流量的</h3><ol><li>修改客户端 - 手动或自动修改浏览器代理配置，客户端的http请求直接发给代理</li><li>修改网络 - 在客户端不知道的情况下，拦截网络流量并将其导入代理，这种拦截称为拦截代理。例：连接使用公共wifi时，会有将所有的站点修改到本地的hosts,获取拦截的流量信息后再请求问点返回。</li></ol>]]></content>
    
    <summary type="html">
    
      http 代理详解
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
      <category term="http" scheme="//yeyute.github.io/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>CGI、FastCGI、PHP-CGI、PHP-FPM 关系简单分析</title>
    <link href="//yeyute.github.io/2015/05/11/CGI%E3%80%81FastCGI%E3%80%81PHP-CGI%E3%80%81PHP-FPM-%E5%85%B3%E7%B3%BB%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90/"/>
    <id>//yeyute.github.io/2015/05/11/CGI、FastCGI、PHP-CGI、PHP-FPM-关系简单分析/</id>
    <published>2015-05-11T02:12:52.000Z</published>
    <updated>2017-03-09T05:08:39.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="CGI、FastCGI、PHP-CGI、PHP-FPM-关系简单总结"><a href="#CGI、FastCGI、PHP-CGI、PHP-FPM-关系简单总结" class="headerlink" title="CGI、FastCGI、PHP-CGI、PHP-FPM 关系简单总结"></a>CGI、FastCGI、PHP-CGI、PHP-FPM 关系简单总结</h3><table><thead><tr><th style="text-align:left">value</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left">CGI</td><td style="text-align:left">抽象来说是通用的服务网关， 标准的CGI对每个请求都会解析php.ini文件，初始化执行环境</td></tr><tr><td style="text-align:left">PHP-CGI</td><td style="text-align:left">php-cgi只是解释PHP脚本的程序而已</td></tr><tr><td style="text-align:left">FastCGI</td><td style="text-align:left">一种管理php-cgi的协议(抽象)，一套由操作系统管理的php-cgi管理程序(具体) ，是用来提高CGI程序性能的</td></tr><tr><td style="text-align:left">PHP-FPM</td><td style="text-align:left">实现fast-cgi协议的具体程序</td></tr></tbody></table><p>例：mvc与tp框架的关系， mvc是一种设计模式，tp框架是实现mvc模式的具体程序。</p>]]></content>
    
    <summary type="html">
    
      CGI、FastCGI、PHP-CGI、PHP-FPM
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="php" scheme="//yeyute.github.io/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>深入理解 Memcached</title>
    <link href="//yeyute.github.io/2015/03/11/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-Memcached/"/>
    <id>//yeyute.github.io/2015/03/11/深入理解-Memcached/</id>
    <published>2015-03-11T06:41:37.000Z</published>
    <updated>2017-10-10T12:09:13.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul><li>单个item 最大的数据 1M</li><li>单进程最大的使用内存 2G ，需要更多内存时可开多个端口</li><li>memcached 是多线程，非阻塞io复用的网络模型，redis 是单线程</li><li>键长最大250字节</li></ul><p>MEMCACHE_COMPRESSED为压缩选项，缩后数据一般为原数据大小的30%左右，节省了70%的传输性能消耗所得会大于文件压缩带来的性能损耗；<br>存的数据的确有大于几百字节的，如果都是小于100字节的键值对，压缩可能反而带来膨胀，</p><a id="more"></a><h3 id="常见的运用场景"><a href="#常见的运用场景" class="headerlink" title="常见的运用场景"></a>常见的运用场景</h3><ul><li>memcached来保持session，实现session共享（session跨服务器的一种解决方案）</li></ul><h3 id="解释压缩"><a href="#解释压缩" class="headerlink" title="解释压缩"></a>解释压缩</h3><blockquote><p>注：php 官网的memcache 扩展的最新几个版本，当value好像是大于20k时（具体数值待验证），会自动压缩，尝试过压缩后有乱码情况,尝试使用1。1版本的不会自动压缩的情况</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">set</span>(<span class="variable">$this</span>-&gt;_key(<span class="variable">$key</span>), <span class="variable">$value</span>, MEMCACHE_COMPRESSED, <span class="variable">$ttl</span>);</div></pre></td></tr></table></figure><p>MEMCACHE_COMPRESSED为压缩选项缩后数据一般为原数据大小的30%左右，节省了70%的传输性能消耗所得会大于文件压缩带来的性能损耗；存的数据的确有大于几百字节的，如果都是小于100字节的键值对，压缩可能反而带来膨胀，Memcached中都是按照固定大小分块存储的，最小也要88 B。所以对于过小数据带来的压缩膨胀并不是太大的问题；</p><h3 id="内存管理机制（默认是使用Slab-Allocatoion机制分配、管理内存）"><a href="#内存管理机制（默认是使用Slab-Allocatoion机制分配、管理内存）" class="headerlink" title="内存管理机制（默认是使用Slab Allocatoion机制分配、管理内存）"></a>内存管理机制（默认是使用Slab Allocatoion机制分配、管理内存）</h3><ul><li>将内存分割成各种尺寸的块(chunk),并把尺寸相同的块分成组(chunk的集合)</li><li>page 是分配Slab的内存空间 默认是1M 根据Slab大小切分成chunk</li><li>chunk:用户缓存记录的内存空间</li><li>Slab class：特定chunk的组</li></ul><p>如何组织数据的呢？<br>内存分配流程</p><p><img src="https://yeyute.github.io/assets/memcached.png" alt="memcached"></p><table><thead><tr><th style="text-align:left">内存单位</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">slab</td><td style="text-align:left">数据大小相似的为一类, 放在同一个slab中.(按照chunk分类)</td></tr><tr><td style="text-align:left">page</td><td style="text-align:left">每个page分配1M大小, 该类slab下的chunk用完, 重新申请一个page; 分配一次的大小. 如果没有page, 每次分配初始化一个chunk太浪费资源.</td></tr><tr><td style="text-align:left">chunk</td><td style="text-align:left">数据存放最小也是最大的单位, 一个key对应的数据不能跨chunk(默认最大为1M)</td></tr></tbody></table><table><thead><tr><th style="text-align:left">内存分配参数</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">used_chunks</td><td style="text-align:left">已分配给item的chunk数量, 只分配, 不一定使用（初始化）</td></tr><tr><td style="text-align:left">free_chunks</td><td style="text-align:left">尚未分配的chunk数量, 由delete释放的chunk(get不到时也会释放)</td></tr><tr><td style="text-align:left">free_chunks_end</td><td style="text-align:left">分配后还没有被使用过的chunk</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      深入理解 Memcached
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="nosql" scheme="//yeyute.github.io/tags/nosql/"/>
    
  </entry>
  
  <entry>
    <title>hexo 命令</title>
    <link href="//yeyute.github.io/2015/03/10/hexo-%E5%91%BD%E4%BB%A4/"/>
    <id>//yeyute.github.io/2015/03/10/hexo-命令/</id>
    <published>2015-03-10T02:06:47.000Z</published>
    <updated>2017-10-10T12:10:23.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># 全局安装安装</span></div><div class="line">npm install hexo -g</div><div class="line"><span class="meta"># 升级  </span></div><div class="line">npm update hexo -g  </div><div class="line"><span class="meta"># 初始化 </span></div><div class="line">hexo init</div></pre></td></tr></table></figure><a id="more"></a><h3 id="简写"><a href="#简写" class="headerlink" title="简写"></a>简写</h3><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 本地启动服务</span></div><div class="line">hexo <span class="attr">s</span> == hexo server  </div><div class="line"><span class="comment"># 生成静态文件</span></div><div class="line">hexo <span class="attr">g</span> = hexo generate </div><div class="line"><span class="comment"># 部署,将代码上传到配置的服务器</span></div><div class="line">hexo <span class="attr">d</span> == hexo deploy</div></pre></td></tr></table></figure><h3 id="新建"><a href="#新建" class="headerlink" title="新建"></a>新建</h3><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># 新建文章</span></div><div class="line">hexo <span class="keyword">new</span> <span class="string">"postName"</span></div><div class="line"><span class="meta"># 新建页面 </span></div><div class="line">hexo <span class="keyword">new</span> page <span class="string">"pageName"</span></div></pre></td></tr></table></figure><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><p>删除 ./source/_posts/里对应的md文件. ps:不能全部删除，会报错。<br>然后对应执行</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hexo <span class="attr">g</span> == hexo generate<span class="comment">#生成</span></div><div class="line">hexo <span class="attr">s</span> == hexo server <span class="comment">#启动服务预览</span></div><div class="line">hexo <span class="attr">d</span> == hexo deploy<span class="comment">#部署</span></div></pre></td></tr></table></figure><p>hexo clean,直接把public下的所有文章和分类目录都删除了,tags,archices,categories也会重新布局,请小心操作</p><h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># Hexo 会监视文件变动并自动更新，您无须重启服务器。</span></div><div class="line">hexo server </div><div class="line"><span class="meta"># 静态模式</span></div><div class="line">hexo server -s </div><div class="line"><span class="meta"># 更改端口</span></div><div class="line">hexo server -p <span class="number">5000</span> </div><div class="line"><span class="meta"># 自定义 IP</span></div><div class="line">hexo server -i <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></div><div class="line"></div><div class="line"><span class="meta"># 清除缓存 网页正常情况下可以忽略此条命令,public 文件夹内容将全部删除</span></div><div class="line">hexo clean </div><div class="line"><span class="meta"># 生成静态网页</span></div><div class="line">hexo g </div><div class="line"><span class="meta"># 开始部署</span></div><div class="line">hexo d</div></pre></td></tr></table></figure><h3 id="监视文件变动"><a href="#监视文件变动" class="headerlink" title="监视文件变动"></a>监视文件变动</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 使用 Hexo 生成静态文件快速而且简单</div><div class="line">hexo <span class="keyword">generate</span></div><div class="line"># 监视文件变动</div><div class="line">hexo <span class="keyword">generate</span> --watch</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      hexo
    
    </summary>
    
      <category term="Technology" scheme="//yeyute.github.io/categories/Technology/"/>
    
    
      <category term="笔记" scheme="//yeyute.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
</feed>
